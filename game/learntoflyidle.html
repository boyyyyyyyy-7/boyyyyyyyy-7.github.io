<!DOCTYPE html>
<html>

<body style="width:100vw;height:100vh;margin:0;padding:0;overflow:hidden">
    <script>
        var gamPath = "g/Ruffle/swfs/learntoflyidle.js";
        function loadScripts(scripts, callback) {
            var loadedCount = 0;
            function scriptLoaded() {
                loadedCount++;
                if (loadedCount === scripts.length) {
                    callback(null);
                }
            }
            scripts.forEach(function (script) {
                var scriptTag = document.createElement('script');
                scriptTag.src = script;
                scriptTag.onload = scriptLoaded;
                scriptTag.onerror = function () {
                    callback(new Error('Failed to load script: ' + script));
                };
                document.head.appendChild(scriptTag);
            });
        }

        function generateRandomString() {
            var chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
            var result = '';

            for (var i = 0; i < 10; i++) {
                var randomIndex = Math.floor(Math.random() * chars.length);
                result += chars.charAt(randomIndex);
            }

            return result;
        }

        var channel = generateRandomString();
        const bc = new BroadcastChannel(channel);

        loadScripts([gamPath], function (error) {
            if (error) {
                alert('Failed to load scripts: ' + error.message);
                console.error('Failed to load scripts:', error);
                return;
            }
            var frame = document.createElement('iframe');
            frame.setAttribute('frameborder', 0);
            frame.style.width = '100%';
            frame.style.height = '100%';
            frame.style.margin = '0';
            frame.style.padding = '0';
            frame.src = "g/Ruffle/player.html?channel=" + channel;
            document.body.appendChild(frame);
            frame.onload = function () {
                bc.postMessage({ type: "swf", data: window.data });
            }
        });

        bc.onmessage = (event) => {
            var eventType = (event.data.type);
            if (eventType == 'close') {
                bc.close();
            }
        };
    </script>
</body>

</html>