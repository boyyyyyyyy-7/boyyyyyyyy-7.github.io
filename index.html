<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1994347174379480"
     crossorigin="anonymous"></script>
<!DOCTYPE html>
<html lang="en">
<script>
// #region agent log - Hypothesis A: Browser cache serving old content
fetch('http://127.0.0.1:7242/ingest/a7fcfa60-2a83-4652-be39-96291f61b443',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:4',message:'Page load started',data:{url:window.location.href,userAgent:navigator.userAgent},timestamp:Date.now(),sessionId:'debug-session',runId:'initial',hypothesisId:'A'})}).catch(()=>{});

window.addEventListener('load', function() {
    // #region agent log - Hypothesis E: Check DOM and service worker on window load
    const bgManagerRefs = Array.from(document.querySelectorAll('script')).filter(s => s.src && s.src.includes('background-manager'));
    const allScripts = Array.from(document.querySelectorAll('script')).map(s => s.src || s.innerHTML.substring(0,50));

    fetch('http://127.0.0.1:7242/ingest/a7fcfa60-2a83-4652-be39-96291f61b443',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:window-load',message:'Window loaded, checking for background-manager references',data:{bgManagerRefs:bgManagerRefs.length,allScripts:allScripts,hasServiceWorker:'serviceWorker' in navigator},timestamp:Date.now(),sessionId:'debug-session',runId:'initial',hypothesisId:'E'})}).catch(()=>{});

    // Check if service worker is registered
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(registrations => {
            fetch('http://127.0.0.1:7242/ingest/a7fcfa60-2a83-4652-be39-96291f61b443',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:SW-check',message:'Service worker registrations found',data:{registrationCount:registrations.length,urls:registrations.map(r => r.scope)},timestamp:Date.now(),sessionId:'debug-session',runId:'initial',hypothesisId:'E'})}).catch(()=>{});
        });
    }

    // #region agent log - Hypothesis F: Track scroll attempts
    let scrollAttempts = 0;
    window.addEventListener('scroll', function() {
        scrollAttempts++;
        fetch('http://127.0.0.1:7242/ingest/a7fcfa60-2a83-4652-be39-96291f61b443',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:scroll',message:'Scroll event detected',data:{scrollAttempts:scrollAttempts,scrollY:window.scrollY,scrollX:window.scrollX},timestamp:Date.now(),sessionId:'debug-session',runId:'scroll-test',hypothesisId:'F'})}).catch(()=>{});
    }, { passive: true });

    window.addEventListener('touchmove', function(e) {
        fetch('http://127.0.0.1:7242/ingest/a7fcfa60-2a83-4652-be39-96291f61b443',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:touchmove',message:'Touch move detected',data:{touches:e.touches.length,defaultPrevented:e.defaultPrevented},timestamp:Date.now(),sessionId:'debug-session',runId:'scroll-test',hypothesisId:'F'})}).catch(()=>{});
    }, { passive: true });
    // #endregion
    // #endregion
});
// #endregion
</script>
<head>
    <!-- Meta Information -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    
    <!-- PWA Support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0a0a0a">
    
    <!-- SEO and Social Media -->
    <meta property="og:title" content="Brayden is tall games 2">
    <meta property="og:type" content="website">
    <meta property="og:url" content="">
    <meta itemprop="url" content="">
    
    <!-- External Resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Maven+Pro:wght@400;500;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <title>Brayden is tall games 2</title>
    <style>
        @keyframes twinkle {
            0%, 100% { opacity: 0.2; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        
        .star-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            overflow: hidden;
            pointer-events: none;
        }
        
        .star {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            will-change: transform, opacity;
            animation: twinkle 3s infinite ease-in-out;
        }
        
        /* Color variations */
        .star.color1 { background-color: #ffffff; box-shadow: 0 0 10px 2px rgba(255, 255, 255, 0.8); }
        .star.color2 { background-color: #a8e6ff; box-shadow: 0 0 15px 3px rgba(168, 230, 255, 0.8); }
        .star.color3 { background-color: #ffd700; box-shadow: 0 0 15px 3px rgba(255, 215, 0, 0.8); }
        .star.color4 { background-color: #ff9e9e; box-shadow: 0 0 15px 3px rgba(255, 158, 158, 0.8); }
        .star.color5 { background-color: #c0ffb3; box-shadow: 0 0 15px 3px rgba(192, 255, 179, 0.8); }

        .snowflake {
            position: fixed;
            top: -10vh;
            color: rgba(255, 255, 255, 0.95);
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.35);
            pointer-events: none;
            user-select: none;
            z-index: 1;
            animation-name: snowFall, snowSway;
            animation-timing-function: linear, ease-in-out;
            animation-iteration-count: 1, infinite;
        }

        @keyframes snowFall {
            0% { transform: translateY(-10vh); }
            100% { transform: translateY(110vh); }
        }

        @keyframes snowSway {
            0%, 100% { margin-left: 0; }
            50% { margin-left: 20px; }
        }
    </style>
    <style>
        /* Base Styles */
        :root {
            --primary-color: #4ecdc4;
            --dark-bg: #0a0a0a;
            --light-bg: #ffffff;
            --text-light: #f9f9f9;
            --text-dark: #0a0a0a;
            --transition: all 0.3s ease;
            
            /* Theme variables */
            --bg-color: #0a0a0a;
            --card-bg: rgba(30, 30, 30, 0.8);
            --card-border: rgba(255, 255, 255, 0.18);
            --header-bg: rgba(8, 15, 19, 0.9);
        }

        /* Classic Theme (Default) */
        .classic-theme {
            --bg-color: #0a0a0a;
            --card-bg: rgba(30, 30, 30, 0.8);
            --card-border: rgba(255, 255, 255, 0.18);
            --header-bg: rgba(8, 15, 19, 0.9);
            --text-light: #f9f9f9;
            --text-dark: #0a0a0a;
            --primary-color: #4ecdc4;
        }
        
        /* Light Theme */
        .light-theme {
            --bg-color: #f6f7fb;
            --card-bg: rgba(255, 255, 255, 0.92);
            --card-border: rgba(15, 23, 42, 0.10);
            --header-bg: rgba(255, 255, 255, 0.82);
            --text-light: #0f172a;
            --text-dark: #0f172a;
            --primary-color: #2563eb;
        }

        /* Ocean Theme */
        .ocean-theme {
            --bg-color: #051a2a;
            --card-bg: rgba(8, 32, 52, 0.78);
            --card-border: rgba(56, 189, 248, 0.22);
            --header-bg: rgba(6, 26, 42, 0.88);
            --primary-color: #38bdf8;
        }

        /* Sunset Theme */
        .sunset-theme {
            --bg-color: #1a0b1f;
            --card-bg: rgba(35, 12, 38, 0.82);
            --card-border: rgba(255, 138, 91, 0.25);
            --header-bg: rgba(26, 11, 31, 0.9);
            --primary-color: #ff8a5b;
        }

        /* Forest Theme */
        .forest-theme {
            --bg-color: #06150f;
            --card-bg: rgba(8, 24, 18, 0.82);
            --card-border: rgba(110, 231, 183, 0.22);
            --header-bg: rgba(6, 21, 15, 0.9);
            --primary-color: #6ee7b7;
        }

        /* Neon Theme */
        .neon-theme {
            --bg-color: #050510;
            --card-bg: rgba(12, 12, 28, 0.85);
            --card-border: rgba(168, 85, 247, 0.25);
            --header-bg: rgba(5, 5, 16, 0.88);
            --primary-color: #a855f7;
        }

        /* Lavender Theme */
        .lavender-theme {
            --bg-color: #140f24;
            --card-bg: rgba(24, 18, 44, 0.84);
            --card-border: rgba(216, 180, 254, 0.22);
            --header-bg: rgba(20, 15, 36, 0.9);
            --primary-color: #d8b4fe;
        }

        /* Christmas Theme */
        .christmas-theme {
            --bg-color: #0d1a26;
            --card-bg: rgba(13, 26, 38, 0.8);
            --card-border: rgba(255, 50, 50, 0.3);
            --header-bg: rgba(13, 26, 38, 0.9);
            --primary-color: #ff4d4d;
        }

        /* Apply theme colors */
        body {
            background: var(--bg-color);
            color: var(--text-light);
            transition: background-color 0.5s ease;
        }
        
        header {
            background: var(--header-bg);
        }
        
        .game-card {
            background: var(--card-bg);
            border: 1.5px solid var(--card-border);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        #streakCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.7;
            pointer-events: none;
        }
        
        html, body {
            overflow-y: auto;
            height: auto;
        }
        
        body {
            font-family: 'Maven Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-color);
            color: var(--text-light);
            line-height: 1.6;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            position: relative;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        /* Light Mode Styles */
        body.light-mode {
            background: var(--bg-color);
            color: var(--text-light);
        }
        
            /* Settings button styles */
            .settings-btn {
                position: fixed;
                top: 15px;
                right: 15px;
                background: rgba(78, 205, 196, 0.95);
                color: #0a0a0a;
                border: 2px solid rgba(78, 205, 196, 0.5);
                border-radius: 50%;
                width: 55px;
                height: 55px;
                font-size: 22px;
                cursor: pointer;
                z-index: 9999;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 4px 20px rgba(78, 205, 196, 0.4), 0 0 30px rgba(78, 205, 196, 0.2);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
            }

            .settings-btn:hover {
                background: rgba(78, 205, 196, 1);
                border-color: rgba(78, 205, 196, 0.8);
                transform: scale(1.15);
                box-shadow: 0 6px 25px rgba(78, 205, 196, 0.6), 0 0 40px rgba(78, 205, 196, 0.4);
            }

            .settings-btn:active {
                transform: scale(1.05);
            }

            /* Streak display styles */
            .streak-display {
                position: fixed;
                top: 15px;
                left: 15px;
                background: rgba(78, 205, 196, 0.9);
                color: #0a0a0a;
                border-radius: 20px;
                padding: 10px 18px;
                font-size: 16px;
                font-weight: bold;
                display: flex;
                align-items: center;
                gap: 8px;
                z-index: 9999;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                min-width: 60px;
                height: 44px;
                justify-content: center;
            }

            .streak-display:hover {
                background: rgba(78, 205, 196, 1);
                transform: scale(1.05);
            }

            .streak-display .flame {
                font-size: 18px;
                filter: drop-shadow(0 0 3px rgba(255, 100, 0, 0.5));
                animation: flame-flicker 2s ease-in-out infinite alternate;
            }

            @keyframes flame-flicker {
                0% { transform: scale(1); opacity: 1; }
                100% { transform: scale(1.1); opacity: 0.9; }
            }

            /* Red notification dots */
            .notification-dot {
                position: absolute;
                top: -2px;
                right: -2px;
                width: 12px;
                height: 12px;
                background: #ff4757;
                border-radius: 50%;
                border: 2px solid #0a0a0a;
                box-shadow: 0 0 6px rgba(255, 71, 87, 0.8);
                animation: pulse-dot 2s ease-in-out infinite;
                z-index: 10001;
            }

            .settings-btn .notification-dot {
                border-color: #0a0a0a;
            }

            .streak-display .notification-dot {
                border-color: #0a0a0a;
            }

            @keyframes pulse-dot {
                0%, 100% { transform: scale(1); opacity: 1; }
                50% { transform: scale(1.2); opacity: 0.8; }
            }
        
        /* Settings menu styles */
        .settings-menu {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(78, 205, 196, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(78, 205, 196, 0.3);
            border-radius: 10px;
            padding: 20px;
            min-width: 250px;
            z-index: 1000;
            transform: translateY(-20px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }
        
        .settings-menu.active {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }
        
        .settings-menu h3 {
            color: #0a0a0a;
            margin-bottom: 15px;
            font-size: 1.2em;
            text-align: center;
        }
        
        .settings-option {
            margin-bottom: 15px;
        }
        
        .settings-option label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: #0a0a0a;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }
        
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .toggle-switch.active {
            background: #4ecdc4;
        }
        
        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: #fff;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }
        
        .toggle-switch.active::after {
            transform: translateX(26px);
        }
        
        .settings-menu .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: #4ecdc4;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
        }
        
        .settings-menu .close-btn:hover {
            color: #f9f9f9;
        }
        
        /* Fullscreen button styles */
        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 90px;
            background: rgba(78, 205, 196, 0.9);
            color: #0a0a0a;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .fullscreen-btn:hover {
            background: rgba(78, 205, 196, 1);
            transform: scale(1.1);
        }
        
        .fullscreen-btn:active {
            transform: scale(0.95);
        }
        
        
        /* Hide fullscreen button on desktop */
        @media (min-width: 769px) {
            .fullscreen-btn {
                display: none;
            }
        }
        
        /* Moving Stars Background - Dark Mode */
        body::before {
            content: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(2px 2px at 20px 30px, #eee, transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.8), transparent),
                radial-gradient(1px 1px at 90px 40px, #fff, transparent),
                radial-gradient(1px 1px at 130px 80px, rgba(255,255,255,0.6), transparent),
                radial-gradient(2px 2px at 160px 30px, #ddd, transparent);
            background-repeat: repeat;
            background-size: 200px 100px;
            animation: moveStars 20s linear infinite;
            pointer-events: none;
            z-index: 0;
        }
        
        /* Light Mode - White Sky with Black Stars */
        body.light-mode::before {
            background: 
                radial-gradient(2px 2px at 20px 30px, #000, transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(0,0,0,0.8), transparent),
                radial-gradient(1px 1px at 90px 40px, #000, transparent),
                radial-gradient(1px 1px at 130px 80px, rgba(0,0,0,0.6), transparent),
                radial-gradient(2px 2px at 160px 30px, #333, transparent);
        }
        
        /* Christmas Mode Styles */
        body.christmas-mode {
            background: #283747; /* Dark blue background for night sky */
            color: #f9f9f9;
            background-attachment: fixed; /* This creates the "sinking" effect */
            background-size: cover; /* Ensure background covers the entire viewport */
            background-position: center center; /* Center the background image */
        }

        body.christmas-mode::before {
            background: 
                url('https://www.transparenttextures.com/patterns/christmas-eves.png') repeat, /* Snow pattern */
                radial-gradient(circle at 15% 15%, rgba(255, 255, 255, 0.4) 1px, transparent 60px),
                radial-gradient(circle at 70% 80%, rgba(255, 255, 255, 0.3) 1px, transparent 40px),
                radial-gradient(circle at 40% 50%, rgba(255, 255, 255, 0.5) 1px, transparent 80px);
            background-size: 200px 200px, cover, cover, cover, cover;
            animation: snowfall 30s linear infinite;
        }

        @keyframes snowfall {
            0% { background-position: 0 0, 0 0, 0 0, 0 0, 0 0; }
            100% { background-position: 0 200px, 0 200px, 0 200px, 0 200px, 0 200px; }
        }

        body.christmas-mode::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(4px 4px at 30px 40px, #fff, transparent),
                radial-gradient(3px 3px at 80px 10px, rgba(255,255,255,0.8), transparent),
                radial-gradient(5px 5px at 120px 60px, #ddd, transparent),
                radial-gradient(2px 2px at 180px 90px, rgba(255,255,255,0.6), transparent),
                radial-gradient(6px 6px at 200px 20px, #eee, transparent);
            background-repeat: repeat;
            background-size: 180px 180px; /* Adjust size for more varied flakes */
            animation: moveSnowflakes 25s linear infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes moveSnowflakes {
            0% { transform: translateY(0px); opacity: 1; }
            50% { opacity: 0.8; }
            100% { transform: translateY(200px); opacity: 0; }
        }
        
        @keyframes moveStars {
            0% { transform: translateX(0px) translateY(0px); }
            100% { transform: translateX(-200px) translateY(-100px); }
        }
        
        /* Additional star layers for depth */
        body::after {
            content: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(1px 1px at 50px 50px, #fff, transparent),
                radial-gradient(1px 1px at 100px 100px, rgba(255,255,255,0.8), transparent),
                radial-gradient(1px 1px at 150px 150px, #ddd, transparent),
                radial-gradient(1px 1px at 200px 200px, rgba(255,255,255,0.6), transparent);
            background-repeat: repeat;
            background-size: 300px 200px;
            animation: moveStars2 30s linear infinite;
            pointer-events: none;
            z-index: 0;
        }
        
        @keyframes moveStars2 {
            0% { transform: translateX(0px) translateY(0px); }
            100% { transform: translateX(-300px) translateY(-200px); }
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 10;
        }
        
        header {
            background: var(--header-bg);
            color: var(--text-light);
            border: 1.5px solid var(--card-border);
            border-radius: 18px;
            padding: 60px 0;
            margin-bottom: 40px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(3px) saturate(160%);
            -webkit-backdrop-filter: blur(3px) saturate(160%);
            text-align: center;
            position: relative;
            z-index: 2;
        }

        .light-theme header {
            box-shadow: 0 10px 28px rgba(15, 23, 42, 0.10);
        }
        
        /* Fallback for browsers that don't support backdrop-filter */
        @supports not (backdrop-filter: blur(15px)) {
            header {
                background: var(--header-bg);
                box-shadow: 
                    0 20px 40px rgba(0, 0, 0, 0.4),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2);
            }
        }
        
        h1 {
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--text-light);
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        .light-theme h1 {
            text-shadow: 0 0 18px rgba(0, 0, 0, 0.10);
        }
        
        .game-section {
            margin: 40px 0;
        }
        
        .section-title {
            font-size: 2rem;
            font-weight: 600;
            color: var(--text-light);
            margin-bottom: 30px;
            text-align: center;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        }

        .light-theme .section-title {
            text-shadow: 0 0 14px rgba(0, 0, 0, 0.08);
        }
        
        .search-box {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 32px;
        }
        .search-input {
            background: var(--card-bg);
            border: 1.5px solid var(--card-border);
            border-radius: 12px;
            padding: 12px 20px;
            font-size: 1.1rem;
            color: var(--text-light);
            outline: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.10);
            backdrop-filter: blur(3px) saturate(160%);
            -webkit-backdrop-filter: blur(3px) saturate(160%);
            transition: border-color 0.2s, box-shadow 0.2s;
            width: 320px;
            max-width: 90vw;
        }

        .light-theme .search-input {
            box-shadow: 0 6px 16px rgba(15, 23, 42, 0.08);
        }
        
        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.72);
            opacity: 0.8;
        }
        .light-theme .search-input::placeholder {
            color: rgba(15, 23, 42, 0.55);
            opacity: 0.9;
        }
        .search-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 4px 16px rgba(78,205,196,0.15);
        }
        
        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 32px;
            margin-top: 30px;
            overflow: visible !important;
        }
        
        .game-card {
            background: var(--card-bg);
            color: var(--text-light);
            border: 1.5px solid var(--card-border);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.22, 1, 0.36, 1), transform 0.25s cubic-bezier(0.22, 1, 0.36, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(3px) saturate(160%);
            -webkit-backdrop-filter: blur(3px) saturate(160%);
            text-decoration: none;
        }

        .light-theme .game-card {
            box-shadow: 0 10px 22px rgba(15, 23, 42, 0.10);
        }
        
        .game-card:hover, .game-card:focus-visible {
            background: rgba(255,255,255,0.18);
            border-color: var(--primary-color);
            transform: scale(1.08);
            z-index: 10;
        }

        .light-theme .game-card:hover, .light-theme .game-card:focus-visible {
            background: rgba(15, 23, 42, 0.03);
        }
        
        .game-card:active {
            transform: scale(0.98);
        }
        .game-card::after, .game-card:hover::after { display: none !important; }
        
        .game-card p {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0;
            transition: color 0.3s ease;
        }
        
        .game-card:hover p {
            color: var(--primary-color);
            text-shadow: 0 0 10px rgba(78, 205, 196, 0.5);
        }

        .light-theme .game-card:hover p {
            text-shadow: 0 0 12px rgba(37, 99, 235, 0.25);
        }
        
        .divider {
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
            margin: 40px 0;
            border-radius: 2px;
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.5);
        }
        
        /* Floating animation for cards */
        /* .game-card:nth-child(odd) { animation: float 6s ease-in-out infinite; } */
        /* .game-card:nth-child(even) { animation: float 6s ease-in-out infinite reverse; } */
        /* @keyframes float { ... } */
        
        /* Glow effect for header */
        header::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(78, 205, 196, 0.2) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            border-radius: 50%;
            animation: pulse 4s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.5; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 0.8; transform: translate(-50%, -50%) scale(1.1); }
        }
        
        @media (max-width: 768px) {
            .game-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
            }
            
            h1 {
                font-size: 2.5rem;
            }
            
            .container {
                padding: 15px;
            }
            
            header {
                padding: 40px 0;
            }
            
            /* Prevent horizontal scroll on mobile */
            body {
                overflow-x: hidden;
                width: 100%;
            }
        }
    </style>
</head>
<body>

        <!-- IMMEDIATE GLOBAL RESET FUNCTION - Available right away in console -->
        <script>
            window.resetStreakData = function() {
                console.log('üîÑ Resetting ALL streak data...');

            try {
                // Clear all streak-related localStorage
                localStorage.removeItem('streakDataV2');
                localStorage.removeItem('streakFreezes');
                localStorage.removeItem('bestStreak');
                localStorage.removeItem('streakRestoration_v1'); // Also clear restoration flag for testing

                    // Reset display if element exists
                    const streakNumber = document.getElementById('streakNumber');
                    if (streakNumber) {
                        streakNumber.textContent = '0';
                    }

            console.log('‚úÖ Streak data completely reset!');
            console.log('üîÑ All localStorage keys cleared');
            console.log('üìä Display updated to show streak: 0');

            // Auto-refresh after a short delay to show the reset
            setTimeout(() => {
                location.reload();
            }, 1000);

            return 'Streak reset complete! Page will refresh automatically...';
                } catch (error) {
                    console.error('‚ùå Error resetting streak data:', error);
                    return 'Error occurred while resetting streak data.';
                }
            };

            // Confirm function is available
            console.log('üîß resetStreakData() function loaded and ready!');
        </script>

        <canvas id="streakCanvas"></canvas>
        <div class="star-container" id="starContainer"></div>
        <div style="position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden;">
            unblocked games, free online games, browser games, play games online,
            cool math games unblocked, io games, free browser games, top browser games,
            no download games, multiplayer browser games, html5 games, instant play games,
            free puzzle games online, adventure browser games, action browser games,
            tower defense games free, proxy, roblox unblocked, 3D browser games, platformer games online,
            idle games free, play games without download, no sign up online games,
            online game emulators, free game websites, addicting games online,
            online arcade games, retro games online, safe online games,
        </div>

        <!-- Settings button -->
        <button class="settings-btn" id="settingsBtn" title="Settings">
            ‚öôÔ∏è
            <div class="notification-dot"></div>
        </button>

        <!-- Streak display -->
    <div class="streak-display" id="streakDisplay" title="Daily Streak">
        <span id="streakNumber">0</span>
        <span class="flame">üî•</span>
        <div class="notification-dot"></div>
    </div>

        
        <!-- Settings menu -->
        <div class="settings-menu" id="settingsMenu">
            <button class="close-btn" id="closeSettings">√ó</button>
            <h3>Settings</h3>

            <div class="settings-option">
                <label>
                    Auto Inject About:Blank
                    <div class="toggle-switch" id="injectionToggle">
                        <input type="checkbox" id="injectionCheckbox" style="display: none;">
                    </div>
                </label>
            </div>

            <div class="settings-option">
                <button id="openInjectionBtn" style="width: 100%; padding: 10px; background: #4ecdc4; color: #0a0a0a; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">
                    Inject Into About:Blank
                </button>
            </div>

            <div class="settings-option" style="margin-top: 12px;">
                <label>
                    Stars
                    <div class="toggle-switch" id="starsToggle">
                        <input type="checkbox" id="starsCheckbox" style="display: none;">
                    </div>
                </label>
            </div>

            <div class="settings-option">
                <label for="starsCount" style="display:block; margin-bottom: 6px;">Star Amount: <span id="starsCountLabel">200</span></label>
                <input id="starsCount" type="range" min="50" max="500" step="10" value="200" style="width: 100%;" />
            </div>

            <div class="settings-option">
                <label for="starsSpeed" style="display:block; margin-bottom: 6px;">Star Speed</label>
                <select id="starsSpeed" style="width: 100%; padding: 8px; border-radius: 6px;">
                    <option value="slow" selected>Slow</option>
                    <option value="medium">Medium</option>
                    <option value="fast">Fast</option>
                </select>
            </div>

            <div class="settings-option">
                <label for="starsColor" style="display:block; margin-bottom: 6px;">Star Color</label>
                <select id="starsColor" style="width: 100%; padding: 8px; border-radius: 6px;">
                    <option value="multicolor">Multicolor</option>
                    <option value="white" selected>White</option>
                    <option value="blue">Blue</option>
                    <option value="gold">Gold</option>
                    <option value="pink">Pink</option>
                    <option value="mint">Mint</option>
                </select>
            </div>

            <div class="settings-option">
                <button id="openBackgroundSettingsBtn" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.12); color: inherit; border: 1px solid rgba(255,255,255,0.18); border-radius: 5px; cursor: pointer; font-weight: 600;">
                    Background Settings
                </button>
            </div>
        </div>

        <!-- Fullscreen button for mobile -->
        <button class="fullscreen-btn" id="fullscreenBtn" title="Toggle Fullscreen">
            <span id="fullscreenIcon">‚õ∂</span>
        </button>


        <div class="container">
            <header>
                <h1>Brayden is tall games 2</h1>
            </header>
            
            <div class="game-section">
            <h2 class="section-title">Game list</h2>
            
            <div class="search-box">
                <input class="search-input" type="text" placeholder="Search games..." />
            </div>
            
            <div class="game-grid">
                <a class="game-card" href="crazy-cattle-3d.html">
                    <p>Crazy cattle 3d</p>
                </a>
                <a class="game-card" href="crazy-chicken-3d.html">
                    <p>Crazy chicken 3D</p>
                </a>
                <!-- Removed: Crazy kitty 3D -->
                <a class="game-card" href="curve-rush.html">
                    <p>Curve Rush</p>
                </a>
                <a class="game-card" href="slender-multiplayer.html">
                    <p>Slender Multiplayer</p>
                </a>
                <a class="game-card" href="escape-road-2.html">
                    <p>Escape Road 2</p>
                </a>
                <a class="game-card" href="cars.html">
                    <p>Cars</p>
                </a>
                <a class="game-card" href="drive-mad.html">
                    <p>Drive mad</p>
                </a>
                <!-- Removed: Shell shockers -->
                <a class="game-card" href="basketball-stars.html">
                    <p>Basketball stars</p>
                </a>
                <!-- Removed: Minecraft -->
                <!-- Removed: OVO -->
                <a class="game-card" href="smash-karts.html">
                    <p>Smash karts</p>
                </a>
                <a class="game-card" href="crossy-road.html">
                    <p>Crossy Road</p>
                </a>
                <a class="game-card" href="1v1-lol.html">
                    <p>1v1.lol</p>
                </a>
                <a class="game-card" href="speed-stars.html">
                    <p>Speed Stars</p>
                </a>
                <a class="game-card" href="ragdoll-archers.html">
                    <p>Ragdoll Archers</p>
                </a>
                <a class="game-card" href="cookie-clicker.html">
                    <p>Cookie clicker</p>
                </a>

                <a class="game-card" href="slow-roads.html">
                    <p>slow roads</p>
                </a>
                <!-- Removed: Escape Road -->
                <a class="game-card" href="golf-orbit.html">
                    <p>Golf Orbit</p>
                </a>
                <a class="game-card" href="traffic-road.html">
                    <p>Traffic Road</p>
                </a>
                <!-- Removed: Wave Dash -->
                <a class="game-card" href="ragdoll-hit-stickman.html">
                    <p>Ragdoll Hit Stickman</p>
                </a>

                <!-- Removed: Chill Guy Clicker -->

                <a class="game-card" href="granny.html">
                    <p>Granny</p>
                </a>

                <a class="game-card" href="cowboy-safari.html">
                    <p>Cowboy Safari</p>
                </a>

                <a class="game-card" href="slope-rider.html">
                    <p>Slope Rider</p>
                </a>

                <a class="game-card" href="ramp-xtreme.html">
                    <p>Ramp Xtreme</p>
                </a>

                <a class="game-card" href="geometry-lite.html">
                    <p>Geometry Lite</p>
                </a>
            </div>
        </div>
    </div>
    </div>

    <!-- Streak functionality -->
    <script>
        const STORAGE_KEY_V2 = 'streakDataV2';

        const XOR_KEY = "StreakSecure2024!@#$%^&*()_+-=[]{}|;:,.<>?";

        function xorCrypt(text, key) {
            let result = '';
            for (let i = 0; i < text.length; i++) {
                const textChar = text.charCodeAt(i);
                const keyChar = key.charCodeAt(i % key.length);
                result += String.fromCharCode(textChar ^ keyChar);
            }
            return result;
        }

        function getDeviceFingerprint() {
            const fingerprint = [
                navigator.userAgent,
                navigator.language,
                screen.width + 'x' + screen.height,
                new Date().getTimezoneOffset(),
                navigator.platform
            ].join('|');

            let hash = 0;
            for (let i = 0; i < fingerprint.length; i++) {
                const char = fingerprint.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return Math.abs(hash).toString();
        }

        function getRollingSeed() {
            const now = new Date();
            const dateStr = now.toISOString().split('T')[0];
            const hour = now.getHours();
            const deviceId = getDeviceFingerprint();

            let seed = 0;
            const seedStr = dateStr + hour.toString() + deviceId;
            for (let i = 0; i < seedStr.length; i++) {
                seed += seedStr.charCodeAt(i) * (i + 1);
            }
            return seed;
        }

        function generateChecksum(data) {
            const seed = getRollingSeed();
            const str = JSON.stringify({
                visits: data.visits,
                freezes: data.freezes,
                usedFreezes: data.usedFreezes,
                lastFreezeWeek: data.lastFreezeWeek,
                best: data.best
            });

            let hash = seed;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }

            return seed.toString() + '_' + hash.toString();
        }

        function validateChecksum(data, storedChecksum) {
            if (!storedChecksum || !storedChecksum.includes('_')) return false;

            const [storedSeed, storedHash] = storedChecksum.split('_');
            const currentSeed = getRollingSeed();

            if (parseInt(storedSeed) !== currentSeed) return false;

            const expectedHash = generateChecksum(data).split('_')[1];
            return storedHash === expectedHash;
        }

        function validateStreakData(data) {
            if (data.freezes < 0 || data.freezes > 1000) return false;
            if (data.best < 0 || data.best > 10000) return false;
            if (!Array.isArray(data.visits) || !Array.isArray(data.usedFreezes)) return false;

            const visitSet = new Set(data.visits);
            if (visitSet.size !== data.visits.length) return false;

            const now = new Date();
            const maxFutureDays = 1;
            for (const visit of data.visits) {
                try {
                    const visitDate = parseDayKey(visit);
                    if (!visitDate) return false;
                    if (visitDate > new Date(now.getTime() + maxFutureDays * 24 * 60 * 60 * 1000)) return false;
                } catch {
                    return false;
                }
            }

            for (const freeze of data.usedFreezes) {
                try {
                    const freezeDate = parseDayKey(freeze);
                    if (!freezeDate) return false;
                } catch {
                    return false;
                }
            }

            return true;
        }

        function normalizeToNoon(date) {
            const d = new Date(date);
            d.setHours(12, 0, 0, 0);
            return d;
        }

        function toDayKey(date) {
            const d = normalizeToNoon(date);
            const y = d.getFullYear();
            const m = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return `${y}-${m}-${day}`;
        }

        function parseDayKey(key) {
            if (!key) return null;
            if (/^\d{4}-\d{2}-\d{2}$/.test(key)) {
                const d = new Date(`${key}T12:00:00`);
                return Number.isNaN(d.getTime()) ? null : normalizeToNoon(d);
            }
            const legacy = new Date(key);
            return Number.isNaN(legacy.getTime()) ? null : normalizeToNoon(legacy);
        }

        function normalizeDayKey(value) {
            const parsed = parseDayKey(value);
            return parsed ? toDayKey(parsed) : null;
        }

        function mergeDayKeys(existing, add) {
            const set = new Set((existing || []).map(normalizeDayKey).filter(Boolean));
            const incoming = Array.isArray(add) ? add : [add];
            incoming.map(normalizeDayKey).filter(Boolean).forEach(k => set.add(k));
            return Array.from(set).sort();
        }

        function getWeekKey(date) {
            const d = normalizeToNoon(date);
            const day = d.getDay();
            const diffToMonday = (day + 6) % 7;
            const monday = new Date(d);
            monday.setDate(d.getDate() - diffToMonday);
            monday.setHours(12, 0, 0, 0);
            return toDayKey(monday);
        }


        function loadV2() {
            let parsed = null;
            try {
                const stored = localStorage.getItem(STORAGE_KEY_V2);
                if (stored) {
                    try {
                        const unreversed = stored.split('').reverse().join('');
                        const base64Decoded = atob(unreversed);
                        const decrypted = xorCrypt(base64Decoded, XOR_KEY);
                        parsed = JSON.parse(decrypted);
                    } catch {
                        try {
                            const unreversed = stored.split('').reverse().join('');
                            parsed = JSON.parse(atob(unreversed));
                        } catch {
                            try {
                                parsed = JSON.parse(atob(stored));
                            } catch {
                                parsed = null;
                            }
                        }
                    }
                }
            } catch {
                parsed = null;
            }

            const base = {
                version: 2,
                visits: [],
                freezes: Number(localStorage.getItem('streakFreezes') || 0) || 0,
                usedFreezes: [],
                lastFreezeWeek: null,
                best: Number(localStorage.getItem('bestStreak') || 0) || 0,
                checksum: null
            };

            if (!parsed || typeof parsed !== 'object') return base;

            let loadedData = {
                ...base,
                version: 2,
                visits: Array.isArray(parsed.visits) ? parsed.visits : base.visits,
                freezes: Number.isFinite(parsed.freezes) ? parsed.freezes : base.freezes,
                usedFreezes: Array.isArray(parsed.usedFreezes) ? parsed.usedFreezes : base.usedFreezes,
                lastFreezeWeek: typeof parsed.lastFreezeWeek === 'string' ? parsed.lastFreezeWeek : base.lastFreezeWeek,
                best: Number.isFinite(parsed.best) ? parsed.best : base.best,
                checksum: parsed.checksum || null
            };

            if (!validateStreakData(loadedData)) {
                localStorage.removeItem(STORAGE_KEY_V2);
                localStorage.removeItem('streakFreezes');
                localStorage.removeItem('bestStreak');
                return base;
            }

            if (loadedData.checksum && !validateChecksum(loadedData, loadedData.checksum)) {
                localStorage.removeItem(STORAGE_KEY_V2);
                localStorage.removeItem('streakFreezes');
                localStorage.removeItem('bestStreak');
                return base;
            }


            return loadedData;
        }

        function saveV2(data) {
            if (!validateStreakData(data)) {
                return;
            }

            data.checksum = generateChecksum(data);

            const jsonData = JSON.stringify(data);
            const encrypted = xorCrypt(jsonData, XOR_KEY);
            const base64Encoded = btoa(encrypted);
            const reversed = base64Encoded.split('').reverse().join('');
            localStorage.setItem(STORAGE_KEY_V2, reversed);

            localStorage.setItem('streakFreezes', String(data.freezes));
            localStorage.setItem('bestStreak', String(data.best));
        }

        function migrateLegacyIntoV2(data) {
            const practiced = (() => {
                try {
                    return JSON.parse(localStorage.getItem('practicedDays') || '[]');
                } catch {
                    return [];
                }
            })();

            const used = (() => {
                try {
                    return JSON.parse(localStorage.getItem('usedFreezes') || '[]');
                } catch {
                    return [];
                }
            })();

            data.visits = mergeDayKeys(data.visits, practiced);
            data.usedFreezes = mergeDayKeys(data.usedFreezes, used);

            return data;
        }

        function recordVisit(data, date = new Date()) {
            const today = normalizeToNoon(date);
            const key = toDayKey(today);
            data.visits = mergeDayKeys(data.visits, key);

            if (today.getDay() === 1) {
                const weekKey = getWeekKey(today);
                console.log(`üìÖ Monday detected! Current week: ${weekKey}, Last freeze week: ${data.lastFreezeWeek}`);
                if (data.lastFreezeWeek !== weekKey) {
                    data.freezes = Math.max(0, Number(data.freezes) || 0) + 1;
                    data.lastFreezeWeek = weekKey;
                    console.log(`‚ùÑÔ∏è Monday bonus: +1 Freeze (Total: ${data.freezes})`);
                    showToast('Monday bonus: +1 Freeze');
                } else {
                    console.log('‚ùÑÔ∏è Monday bonus already claimed this week');
                }
            } else {
                console.log(`üìÖ Day ${today.getDay()} (not Monday, no freeze)`);
            }

            return data;
        }

        function computeStreak(data, date = new Date()) {
            const today = normalizeToNoon(date);
            const visits = new Set((data.visits || []).map(normalizeDayKey).filter(Boolean));
            let freezesRemaining = Math.max(0, Number(data.freezes) || 0);
            const newlyUsed = [];
            let streak = 0;

            const cursor = new Date(today);
            cursor.setHours(12, 0, 0, 0);

            while (true) {
                const key = toDayKey(cursor);
                const dow = cursor.getDay();
                const isWeekend = dow === 0 || dow === 6;

                if (visits.has(key)) {
                    streak += 1;
                } else if (isWeekend) {
                    // Skip weekends without breaking streak
                } else if (freezesRemaining > 0) {
                    freezesRemaining -= 1;
                    newlyUsed.push(key);
                    streak += 1;
                } else {
                    break;
                }

                cursor.setDate(cursor.getDate() - 1);
                cursor.setHours(12, 0, 0, 0);
                if (getDayDiff(cursor, today) > 365) break;
            }

            // Merge newly used freezes with existing ones for calendar display
            data.usedFreezes = mergeDayKeys(data.usedFreezes, newlyUsed);
            data.freezes = freezesRemaining;
            data.best = Math.max(Number(data.best) || 0, streak);
            return { streak, data };
        }


        function getDayDiff(a, b) {
            const msPerDay = 1000 * 60 * 60 * 24;
            const start = normalizeToNoon(a);
            const end = normalizeToNoon(b);
            return Math.round((end - start) / msPerDay);
        }


        document.addEventListener('DOMContentLoaded', function() {
            let data = loadV2();
            data = migrateLegacyIntoV2(data);
            data = recordVisit(data, new Date());
            const computed = computeStreak(data, new Date());
            data = computed.data;
            saveV2(data);

            const streakNumber = document.getElementById('streakNumber');
            const streakDisplay = document.getElementById('streakDisplay');
            if (streakNumber) {
                streakNumber.textContent = String(computed.streak);
            }

            if (streakDisplay) {
                streakDisplay.addEventListener('click', function() {
                    window.location.href = 'streaks.html';
                });
                streakDisplay.style.cursor = 'pointer';
            }
        });
    </script>

    <script>
        // Main App Configuration
        const AppConfig = {
            selectors: {
                fullscreenBtn: '#fullscreenBtn',
                fullscreenIcon: '#fullscreenIcon',
                searchInput: '.search-input',
                gameCards: '.game-card',
                settingsBtn: '#settingsBtn',
                settingsMenu: '#settingsMenu',
                closeSettings: '#closeSettings'
            },
            classes: {
                active: 'active',
                darkMode: 'dark-mode',
                lightMode: 'light-mode',
                christmasMode: 'christmas-mode'
            },
            settings: {
                darkMode: false,
                injection: false,
                christmasMode: false
            }
        };

        function getStarSettings() {
            const raw = localStorage.getItem('starSettings');
            let parsed = null;
            try {
                parsed = raw ? JSON.parse(raw) : null;
            } catch {
                parsed = null;
            }

            return {
                enabled: parsed && typeof parsed.enabled === 'boolean' ? parsed.enabled : true,
                count: parsed && Number.isFinite(parsed.count) ? parsed.count : 200,
                speed: parsed && typeof parsed.speed === 'string' ? parsed.speed : 'slow',
                color: parsed && typeof parsed.color === 'string' ? parsed.color : 'white'
            };
        }

        function saveStarSettings(next) {
            localStorage.setItem('starSettings', JSON.stringify(next));
        }

        function renderStars(settings) {
            const container = document.getElementById('starContainer');
            if (!container) return;

            if (!settings.enabled) {
                container.innerHTML = '';
                return;
            }

            const count = Math.max(50, Math.min(500, Number(settings.count) || 200));
            const speed = settings.speed || 'slow';
            const color = settings.color || 'white';

            const durations = {
                slow: { min: 4, max: 8 },
                medium: { min: 2, max: 6 },
                fast: { min: 1, max: 3 }
            };
            const range = durations[speed] || durations.medium;

            const palette = {
                multicolor: ['color1', 'color2', 'color3', 'color4', 'color5'],
                white: ['color1'],
                blue: ['color2'],
                gold: ['color3'],
                pink: ['color4'],
                mint: ['color5']
            };
            const colorClasses = palette[color] || palette.multicolor;

            container.innerHTML = '';
            for (let i = 0; i < count; i++) {
                const star = document.createElement('div');
                const size = Math.random() * 2 + 1;
                const duration = Math.random() * (range.max - range.min) + range.min;
                const delay = Math.random() * 5;
                const opacity = Math.random() * 0.7 + 0.3;

                star.className = `star ${colorClasses[Math.floor(Math.random() * colorClasses.length)]}`;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.animationDuration = `${duration}s`;
                star.style.animationDelay = `${delay}s`;
                star.style.opacity = `${opacity}`;

                container.appendChild(star);
            }
        }

        function initStarControls() {
            const starsToggle = document.getElementById('starsToggle');
            const starsCheckbox = document.getElementById('starsCheckbox');
            const starsCount = document.getElementById('starsCount');
            const starsCountLabel = document.getElementById('starsCountLabel');
            const starsSpeed = document.getElementById('starsSpeed');
            const starsColor = document.getElementById('starsColor');

            if (!starsToggle || !starsCheckbox || !starsCount || !starsCountLabel || !starsSpeed || !starsColor) return;

            const applyUiFromSettings = (s) => {
                starsCheckbox.checked = !!s.enabled;
                starsToggle.classList.toggle('active', !!s.enabled);
                starsCount.value = String(s.count);
                starsCountLabel.textContent = String(s.count);
                starsSpeed.value = s.speed;
                starsColor.value = s.color;
            };

            const current = getStarSettings();
            applyUiFromSettings(current);

            const isWinter = () => document.body.classList.contains('christmas-theme') || document.body.classList.contains('christmas-mode');
            const starContainer = document.getElementById('starContainer');
            if (starContainer) starContainer.style.display = (!isWinter() && current.enabled) ? '' : 'none';
            if (!isWinter()) {
                renderStars(current);
            }

            const commit = () => {
                const next = {
                    enabled: !!starsCheckbox.checked,
                    count: Number(starsCount.value),
                    speed: starsSpeed.value,
                    color: starsColor.value
                };

                saveStarSettings(next);

                if (starContainer) {
                    starContainer.style.display = (!isWinter() && next.enabled) ? '' : 'none';
                }
                if (!isWinter()) {
                    renderStars(next);
                }
            };

            starsToggle.addEventListener('click', () => {
                starsCheckbox.checked = !starsCheckbox.checked;
                starsToggle.classList.toggle('active', starsCheckbox.checked);
                commit();
            });

            starsCount.addEventListener('input', () => {
                starsCountLabel.textContent = starsCount.value;
                commit();
            });

            starsSpeed.addEventListener('change', commit);
            starsColor.addEventListener('change', commit);

            window.addEventListener('resize', () => {
                const s = getStarSettings();
                if (!isWinter()) {
                    renderStars(s);
                }
            });
        }

        function clearSnow() {
            if (window.snowInterval) {
                clearInterval(window.snowInterval);
                window.snowInterval = null;
            }
            const snowflakes = document.querySelectorAll('.snowflake');
            snowflakes.forEach(flake => flake.remove());
        }

        function initSnow() {
            clearSnow();

            const spawn = () => {
                const flake = document.createElement('div');
                flake.className = 'snowflake';
                flake.textContent = '‚ùÑ';

                const size = Math.random() * 10 + 10;
                const left = Math.random() * 100;
                const fallDuration = Math.random() * 5 + 7;
                const swayDuration = Math.random() * 2 + 3;
                const delay = Math.random() * 2;
                const opacity = Math.random() * 0.5 + 0.35;

                flake.style.left = `${left}vw`;
                flake.style.fontSize = `${size}px`;
                flake.style.opacity = `${opacity}`;
                flake.style.animationDuration = `${fallDuration}s, ${swayDuration}s`;
                flake.style.animationDelay = `${delay}s, ${Math.random() * 1.5}s`;

                document.body.appendChild(flake);

                const ttl = (fallDuration + delay + 1) * 1000;
                window.setTimeout(() => flake.remove(), ttl);
            };

            for (let i = 0; i < 30; i++) {
                window.setTimeout(spawn, Math.random() * 1500);
            }
            window.snowInterval = window.setInterval(spawn, 250);
        }

        function handleThemeChange(theme) {
            if (!theme) return;

            const allowedThemes = ['classic', 'light', 'christmas'];
            const normalizedTheme = allowedThemes.includes(theme) ? theme : 'christmas';
            localStorage.setItem('selectedTheme', normalizedTheme);
            const existingThemeClasses = Array.from(document.body.classList).filter(c => c.endsWith('-theme'));
            if (existingThemeClasses.length) {
                document.body.classList.remove(...existingThemeClasses);
            }
            document.body.classList.add(normalizedTheme + '-theme');
            document.body.style.backgroundImage = '';
            document.body.style.backgroundColor = '';

            const starContainer = document.getElementById('starContainer');

            if (normalizedTheme === 'christmas') {
                if (starContainer) starContainer.style.display = 'none';
                initSnow();
                return;
            }

            clearSnow();

            const s = getStarSettings();
            if (starContainer) starContainer.style.display = s.enabled ? '' : 'none';
            renderStars(s);
        }
        
        function applySavedBackground() {
            const savedBg = localStorage.getItem('customBackground');
            const bgType = localStorage.getItem('bgType');
            
            if (!savedBg) return;
            
            if (bgType === 'image' || savedBg.startsWith('url')) {
                document.body.style.backgroundImage = savedBg;
                document.body.style.backgroundSize = 'cover';
                document.body.style.backgroundPosition = 'center';
                document.body.style.backgroundAttachment = 'fixed';
                document.body.style.backgroundColor = 'transparent';
            } else if (bgType === 'gradient' || savedBg.startsWith('linear-gradient')) {
                document.body.style.backgroundImage = savedBg;
                document.body.style.backgroundSize = 'cover';
                document.body.style.backgroundAttachment = 'fixed';
                document.body.style.backgroundColor = 'transparent';
            } else {
                document.body.style.backgroundImage = 'none';
                document.body.style.backgroundColor = savedBg;
            }
        }
        
        // Function to apply saved theme on page load
        function applySavedTheme() {
            const savedTheme = localStorage.getItem('selectedTheme');
            const savedBg = localStorage.getItem('customBackground');
            
            // Only apply theme if no custom background is set
            if (!savedBg && savedTheme) {
                handleThemeChange(savedTheme);
            } else if (savedBg) {
                // If there's a saved background, apply it
                applySavedBackground();
            } else {
                // Default to winter theme if nothing is set
                handleThemeChange('christmas');
            }
        }
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize components
            initFullscreen();
            initSearch();
            initSettings();
            initStarControls();

            // Apply saved theme
            applySavedTheme();



            // Listen for theme and background changes from settings page
            window.addEventListener('storage', (e) => {
                if (e.key === 'selectedTheme') {
                    handleThemeChange(e.newValue);
                } else if (e.key === 'customBackground' || e.key === 'bgType') {
                    // If background was changed, apply it
                    if (e.key === 'customBackground' && e.newValue) {
                        if (e.newValue.startsWith('url')) {
                            document.body.style.backgroundImage = e.newValue;
                            document.body.style.backgroundSize = 'cover';
                            document.body.style.backgroundPosition = 'center';
                            document.body.style.backgroundAttachment = 'fixed';
                            document.body.style.backgroundColor = 'transparent';
                        } else if (e.newValue.startsWith('linear-gradient')) {
                            document.body.style.backgroundImage = e.newValue;
                            document.body.style.backgroundSize = 'cover';
                            document.body.style.backgroundAttachment = 'fixed';
                            document.body.style.backgroundColor = 'transparent';
                        } else {
                            document.body.style.backgroundImage = 'none';
                            document.body.style.backgroundColor = e.newValue;
                        }
                    }
                }
            });
        });
        
        // Make handleThemeChange available globally for settings page
        window.handleThemeChange = handleThemeChange;

        // Fullscreen functionality
        function initFullscreen() {
            const fullscreenBtn = document.querySelector(AppConfig.selectors.fullscreenBtn);
            const fullscreenIcon = document.querySelector(AppConfig.selectors.fullscreenIcon);
            let isFullscreen = false;

            if (!fullscreenBtn || !fullscreenIcon) return;

            const isFullscreenSupported = () => 
                document.fullscreenEnabled || 
                document.webkitFullscreenEnabled || 
                document.mozFullScreenEnabled || 
                document.msFullscreenEnabled;

            const enterFullscreen = () => {
                const elem = document.documentElement;
                const requestFullscreen = 
                    elem.requestFullscreen ||
                    elem.webkitRequestFullscreen ||
                    elem.mozRequestFullScreen ||
                    elem.msRequestFullscreen;
                
                if (requestFullscreen) {
                    requestFullscreen.call(elem);
                }
            };

            const exitFullscreen = () => {
                const exit = 
                    document.exitFullscreen ||
                    document.webkitExitFullscreen ||
                    document.mozCancelFullScreen ||
                    document.msExitFullscreen;
                
                if (exit) {
                    exit.call(document);
                }
            };

            const updateFullscreenState = () => {
                const isFullscreenNow = !!(
                    document.fullscreenElement || 
                    document.webkitFullscreenElement || 
                    document.mozFullScreenElement || 
                    document.msFullscreenElement
                );
                
                isFullscreen = isFullscreenNow;
                if (fullscreenIcon) {
                    fullscreenIcon.textContent = isFullscreenNow ? '‚õ∂' : '‚õ∂';
                }
            };

            // Event listeners
            fullscreenBtn.addEventListener('click', () => {
                isFullscreen ? exitFullscreen() : enterFullscreen();
            });

            // Fullscreen change events
            ['fullscreenchange', 'webkitfullscreenchange', 'mozfullscreenchange', 'MSFullscreenChange']
                .forEach(event => document.addEventListener(event, updateFullscreenState));

            // Hide button if not supported
            if (!isFullscreenSupported()) {
                fullscreenBtn.style.display = 'none';
            }
        }

        // Live search filter for game cards
        function initSearch() {
            const searchInput = document.querySelector(AppConfig.selectors.searchInput);
            const gameCards = document.querySelectorAll(AppConfig.selectors.gameCards);

            searchInput.addEventListener('input', () => {
                const query = searchInput.value.trim().toLowerCase();
                gameCards.forEach(card => {
                    const text = card.textContent.trim().toLowerCase();
                    if (query === "" || text.includes(query)) {
                        card.style.display = '';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        }

        // Settings functionality
        function initSettings() {
            // Prevent duplicate execution
            if (window.initSettingsCalled) return;
            window.initSettingsCalled = true;

            const settingsBtn = document.querySelector(AppConfig.selectors.settingsBtn);
            const settingsMenu = document.querySelector(AppConfig.selectors.settingsMenu);
            const closeSettings = document.querySelector(AppConfig.selectors.closeSettings);
            
            // Toggle switches
            const injectionToggle = document.getElementById('injectionToggle');
            
            // Checkboxes
            const injectionCheckbox = document.getElementById('injectionCheckbox');
            
            // Injection button
            const openInjectionBtn = document.getElementById('openInjectionBtn');

            const openBackgroundSettingsBtn = document.getElementById('openBackgroundSettingsBtn');
            
            // Update toggle switch visual states
            function updateToggleStates() {
                injectionToggle.classList.toggle('active', injectionCheckbox.checked);
            }
            
            // Toggle settings menu
            function toggleSettings(event) {
                event.stopPropagation();
                settingsMenu.classList.toggle('active');
            }
            
            // Close settings menu
            function closeSettingsMenu() {
                settingsMenu.classList.remove('active');
            }
            
            // Event listeners
            settingsBtn.addEventListener('click', toggleSettings);
            closeSettings.addEventListener('click', closeSettingsMenu);

            if (openBackgroundSettingsBtn) {
                openBackgroundSettingsBtn.addEventListener('click', (event) => {
                    event.stopPropagation();
                    window.location.href = 'background-settings.html';
                });
            }
            
            // Close menu when clicking outside
            document.addEventListener('click', (event) => {
                if (settingsMenu && settingsBtn && 
                    !settingsMenu.contains(event.target) && 
                    !settingsBtn.contains(event.target)) {
                    closeSettingsMenu();
                }
            });
            
            // Toggle switch functionality
            injectionToggle.addEventListener('click', () => {
                injectionCheckbox.checked = !injectionCheckbox.checked;
                updateToggleStates();
                saveBackgroundSetting('injection', injectionCheckbox.checked); // Use the new save function
                
                // Auto-open about:blank when toggle is enabled
                // Only if we're not already in an iframe (to prevent loops)
                if (injectionCheckbox.checked && !window.frameElement) {
                    openAboutBlank();
                }
            });
            
            // About:Blank injection function
            function openAboutBlank() {
                const newTab = window.open('about:blank', '_blank');
                
                if (newTab) {
                    newTab.document.write('<html><head><title>Brayden-is-tall-games</title></head><body style="margin:0; padding:0; overflow:hidden;">');
                    newTab.document.write('<iframe src="https://braydenistallgames.online" style="border:none; width:100vw; height:100vh;"></iframe>');
                    newTab.document.write('<script src="background-loader.js"><\/script></body></html>');
                    newTab.document.close();
                } else {
                    alert('Popup blocked! Please allow popups for this site.');
                }
            }
            
            // Auto-open about:blank when toggle is enabled
            function checkAndOpenAboutBlank() {
                if (injectionCheckbox.checked) {
                    openAboutBlank();
                }
            }
            
            // Add event listener for the injection button
            openInjectionBtn.addEventListener('click', openAboutBlank);
            
            // Load settings on page load - REMOVED (now handled by background-loader.js)
            // loadSettings();
            
            // Auto-open about:blank if injection is enabled on page load
            // Only if we're not already in an iframe (to prevent loops)
            setTimeout(function() {
                if (!window.frameElement) {
                    checkAndOpenAboutBlank();
                }
            }, 1000); // Wait 1 second after page load
        }

        // Prevent zoom on double tap for mobile (only prevent if it's a true double tap, not scroll)
        let lastTouchEnd = 0;
        let touchStartY = 0;

        document.addEventListener('touchstart', function(event) {
            if (event.touches.length === 1) {
                touchStartY = event.touches[0].clientY;
                // #region agent log - Hypothesis F: Track touch start
                fetch('http://127.0.0.1:7242/ingest/a7fcfa60-2a83-4652-be39-96291f61b443',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:touchstart',message:'Touch start detected',data:{touchStartY:touchStartY,touches:event.touches.length},timestamp:Date.now(),sessionId:'debug-session',runId:'scroll-test',hypothesisId:'F'})}).catch(()=>{});
                // #endregion
            }
        }, { passive: true });

        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            const timeDiff = now - lastTouchEnd;
            const touchEndY = event.changedTouches[0].clientY;
            const yDiff = Math.abs(touchEndY - touchStartY);

            // #region agent log - Hypothesis F: Track touch event behavior
            const willPrevent = timeDiff <= 200 && yDiff <= 2;
            fetch('http://127.0.0.1:7242/ingest/a7fcfa60-2a83-4652-be39-96291f61b443',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html:touchend',message:'Touch end event',data:{timeDiff:timeDiff,yDiff:yDiff,willPrevent:willPrevent,lastTouchEnd:lastTouchEnd,touchStartY:touchStartY,touchEndY:touchEndY},timestamp:Date.now(),sessionId:'debug-session',runId:'scroll-test',hypothesisId:'F'})}).catch(()=>{});
            // #endregion

            // Only prevent default if it's a very quick double tap with almost no movement (not a scroll)
            if (willPrevent) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // Prevent context menu on long press
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });

        // Auto-hide fullscreen button after 3 seconds on mobile
        if (window.innerWidth <= 768) {
            setTimeout(() => {
                document.querySelector(AppConfig.selectors.fullscreenBtn).style.opacity = '0.7';
            }, 3000);
        }
    </script>
    
    <!-- Streak Functionality -->
    
    <!-- Version and Privacy Links -->
    <div style="position: fixed; bottom: 10px; left: 10px; z-index: 1000; color: rgba(255, 255, 255, 0.3); font-size: 0.8rem; font-family: 'Source Code Pro', monospace;">
        vSB3.4
    </div>
    <div style="position: fixed; bottom: 10px; right: 10px; z-index: 1000;">
        <a href="privacy-policy.html" style="color: rgba(255, 255, 255, 0.3); text-decoration: none; font-size: 0.8rem; font-family: 'Source Code Pro', monospace;">Privacy Policy</a>
    </div>
    <script src="background-loader.js"></script> <!-- Background theme loader -->
    <script src="background-loader.js"></script>
    
    <script>
        const s = getStarSettings();
        if (starContainer) starContainer.style.display = s.enabled ? '' : 'none';
        renderStars(s);
    </script>
</body>
</html>
        
        