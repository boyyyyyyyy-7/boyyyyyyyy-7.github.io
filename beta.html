<!DOCTYPE html>
<html lang="en">
<script>
    // Debug logging removed for production
</script>

<head>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500&display=swap" rel="stylesheet">

    <!-- Meta Information -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="referrer" content="strict-origin-when-cross-origin">

    <!-- PWA Support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0a0a0a">

    <!-- SEO and Social Media -->
    <meta name="description"
        content="Play the best online games at Brayden is tall games 2! Enjoy a wide collection of fun, free games including action, puzzle, racing, and multiplayer games. Play instantly in your browser with no downloads required.">
    <meta property="og:title" content="Brayden is tall games 2">
    <meta property="og:description"
        content="Play the best online games at Brayden is tall games 2! Enjoy a wide collection of fun, free games including action, puzzle, racing, and multiplayer games.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="">
    <meta itemprop="url" content="">

    <!-- External Resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Maven+Pro:wght@400;500;700&family=Roboto:wght@300;400;500;700&display=swap"
        rel="stylesheet">

    <!-- Microsoft Clarity Analytics -->
    <script type="text/javascript">
        (function (c, l, a, r, i, t, y) {
            c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
            t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i;
            y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
        })(window, document, "clarity", "script", "upbe2dvlo2");
    </script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CFTDLXZJZJ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-CFTDLXZJZJ');
    </script>

    <title>Brayden is tall games 2</title>
    <style>
        @keyframes twinkle {

            0%,
            100% {
                opacity: 0.2;
                transform: scale(1);
            }

            50% {
                opacity: 1;
                transform: scale(1.2);
            }
        }

        .star-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            overflow: hidden;
            pointer-events: none;
        }

        .star {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            will-change: transform, opacity;
            animation: twinkle 3s infinite ease-in-out;
        }

        /* Color variations */
        .star.color1 {
            background-color: #ffffff;
            box-shadow: 0 0 10px 2px rgba(255, 255, 255, 0.8);
        }

        .star.color2 {
            background-color: #a8e6ff;
            box-shadow: 0 0 15px 3px rgba(168, 230, 255, 0.8);
        }

        .star.color3 {
            background-color: #ffd700;
            box-shadow: 0 0 15px 3px rgba(255, 215, 0, 0.8);
        }

        .star.color4 {
            background-color: #ff9e9e;
            box-shadow: 0 0 15px 3px rgba(255, 158, 158, 0.8);
        }

        .star.color5 {
            background-color: #c0ffb3;
            box-shadow: 0 0 15px 3px rgba(192, 255, 179, 0.8);
        }

        .snowflake {
            position: fixed;
            top: -10vh;
            color: rgba(255, 255, 255, 0.95);
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.35);
            pointer-events: none;
            user-select: none;
            z-index: 1;
            animation-name: snowFall, snowSway;
            animation-timing-function: linear, ease-in-out;
            animation-iteration-count: 1, infinite;
        }

        @keyframes snowFall {
            0% {
                transform: translateY(-10vh);
            }

            100% {
                transform: translateY(110vh);
            }
        }

        @keyframes snowSway {

            0%,
            100% {
                margin-left: 0;
            }

            50% {
                margin-left: 20px;
            }
        }
    </style>
    <style>
        /* Base Styles */
        :root {
            --primary-color: #4ecdc4;
            --dark-bg: #0a0a0a;
            --light-bg: #ffffff;
            --text-light: #f9f9f9;
            --text-dark: #0a0a0a;
            --transition: all 0.3s ease;

            /* Theme variables */
            --bg-color: #0a0a0a;
            --card-bg: rgba(30, 30, 30, 0.8);
            --card-border: rgba(255, 255, 255, 0.18);
            --header-bg: rgba(8, 15, 19, 0.9);
        }

        /* Classic Theme (Default) */
        .classic-theme {
            --bg-color: #0a0a0a;
            --card-bg: rgba(30, 30, 30, 0.8);
            --card-border: rgba(255, 255, 255, 0.18);
            --header-bg: rgba(8, 15, 19, 0.9);
            --text-light: #f9f9f9;
            --text-dark: #0a0a0a;
            --primary-color: #4ecdc4;
        }

        /* Light Theme */
        .light-theme {
            --bg-color: #f6f7fb;
            --card-bg: rgba(255, 255, 255, 0.92);
            --card-border: rgba(15, 23, 42, 0.10);
            --header-bg: rgba(255, 255, 255, 0.82);
            --text-light: #0f172a;
            --text-dark: #0f172a;
            --primary-color: #2563eb;
        }

        /* Ocean Theme */
        .ocean-theme {
            --bg-color: #051a2a;
            --card-bg: rgba(8, 32, 52, 0.78);
            --card-border: rgba(56, 189, 248, 0.22);
            --header-bg: rgba(6, 26, 42, 0.88);
            --primary-color: #38bdf8;
        }

        /* Sunset Theme */
        .sunset-theme {
            --bg-color: #1a0b1f;
            --card-bg: rgba(35, 12, 38, 0.82);
            --card-border: rgba(255, 138, 91, 0.25);
            --header-bg: rgba(26, 11, 31, 0.9);
            --primary-color: #ff8a5b;
        }

        /* Forest Theme */
        .forest-theme {
            --bg-color: #06150f;
            --card-bg: rgba(8, 24, 18, 0.82);
            --card-border: rgba(110, 231, 183, 0.22);
            --header-bg: rgba(6, 21, 15, 0.9);
            --primary-color: #6ee7b7;
        }

        /* Neon Theme */
        .neon-theme {
            --bg-color: #050510;
            --card-bg: rgba(12, 12, 28, 0.85);
            --card-border: rgba(168, 85, 247, 0.25);
            --header-bg: rgba(5, 5, 16, 0.88);
            --primary-color: #a855f7;
        }

        /* Lavender Theme */
        .lavender-theme {
            --bg-color: #140f24;
            --card-bg: rgba(24, 18, 44, 0.84);
            --card-border: rgba(216, 180, 254, 0.22);
            --header-bg: rgba(20, 15, 36, 0.9);
            --primary-color: #d8b4fe;
        }

        /* Christmas Theme */
        .christmas-theme {
            --bg-color: #0d1a26;
            --card-bg: rgba(13, 26, 38, 0.8);
            --card-border: rgba(255, 50, 50, 0.3);
            --header-bg: rgba(13, 26, 38, 0.9);
            --primary-color: #ff4d4d;
        }

        /* Apply theme colors */
        body {
            background: var(--bg-color);
            color: var(--text-light);
            transition: background-color 0.5s ease;
        }

        header {
            background: var(--header-bg);
        }

        .game-card {
            background: var(--card-bg);
            border: 1.5px solid var(--card-border);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        #streakCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.7;
            pointer-events: none;
        }

        html,
        body {
            overflow-y: auto;
            height: auto;
        }

        body {
            font-family: 'Maven Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-color);
            color: var(--text-light);
            line-height: 1.6;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            position: relative;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Light Mode Styles */
        body.light-mode {
            background: var(--bg-color);
            color: var(--text-light);
        }

        /* Settings button styles */
        .settings-btn {
            position: fixed;
            top: 15px;
            right: 15px;
            background: rgba(78, 205, 196, 0.95);
            color: #0a0a0a;
            border: 2px solid rgba(78, 205, 196, 0.5);
            border-radius: 50%;
            width: 55px;
            height: 55px;
            font-size: 22px;
            cursor: pointer;
            z-index: 9999;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(78, 205, 196, 0.4), 0 0 30px rgba(78, 205, 196, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .settings-btn:hover {
            background: rgba(78, 205, 196, 1);
            border-color: rgba(78, 205, 196, 0.8);
            transform: scale(1.15);
            box-shadow: 0 6px 25px rgba(78, 205, 196, 0.6), 0 0 40px rgba(78, 205, 196, 0.4);
        }

        .settings-btn:active {
            transform: scale(1.05);
        }

        /* Streak display styles */
        .streak-display {
            position: fixed;
            top: 15px;
            left: 15px;
            background: rgba(78, 205, 196, 0.9);
            color: #0a0a0a;
            border-radius: 20px;
            padding: 10px 18px;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 9999;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            min-width: 60px;
            height: 44px;
            justify-content: center;
        }

        .streak-display:hover {
            background: rgba(78, 205, 196, 1);
            transform: scale(1.05);
        }

        /* Ensure streak display is always clickable */
        .streak-display {
            pointer-events: auto !important;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .streak-display * {
            pointer-events: none;
        }

        .streak-display .flame {
            font-size: 18px;
            filter: drop-shadow(0 0 3px rgba(255, 100, 0, 0.5));
            animation: flame-flicker 2s ease-in-out infinite alternate;
        }

        @keyframes flame-flicker {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            100% {
                transform: scale(1.1);
                opacity: 0.9;
            }
        }

        /* Red notification dots */
        .notification-dot {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 12px;
            height: 12px;
            background: #ff4757;
            border-radius: 50%;
            border: 2px solid #0a0a0a;
            box-shadow: 0 0 6px rgba(255, 71, 87, 0.8);
            animation: pulse-dot 2s ease-in-out infinite;
            z-index: 10001;
        }

        .settings-btn .notification-dot {
            border-color: #0a0a0a;
        }

        .streak-display .notification-dot {
            border-color: #0a0a0a;
        }

        @keyframes pulse-dot {

            0%,
            100% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.2);
                opacity: 0.8;
            }
        }

        /* Settings menu styles */
        .settings-menu {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(78, 205, 196, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(78, 205, 196, 0.3);
            border-radius: 10px;
            padding: 20px;
            min-width: 250px;
            z-index: 1000;
            transform: translateY(-20px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .settings-menu.active {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }

        .settings-menu h3 {
            color: #0a0a0a;
            margin-bottom: 15px;
            font-size: 1.2em;
            text-align: center;
        }

        .settings-option {
            margin-bottom: 15px;
        }

        .settings-option label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: #0a0a0a;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle-switch.active {
            background: #4ecdc4;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: #fff;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .toggle-switch.active::after {
            transform: translateX(26px);
        }

        .settings-menu .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: #4ecdc4;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
        }

        .settings-menu .close-btn:hover {
            color: #f9f9f9;
        }

        /* Fullscreen button styles */
        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 90px;
            background: rgba(78, 205, 196, 0.9);
            color: #0a0a0a;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 20px;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .fullscreen-btn:hover {
            background: rgba(78, 205, 196, 1);
            transform: scale(1.1);
        }

        .fullscreen-btn:active {
            transform: scale(0.95);
        }


        /* Hide fullscreen button on desktop */
        @media (min-width: 769px) {
            .fullscreen-btn {
                display: none;
            }
        }

        /* Moving Stars Background - Dark Mode */
        body::before {
            content: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(2px 2px at 20px 30px, #eee, transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(255, 255, 255, 0.8), transparent),
                radial-gradient(1px 1px at 90px 40px, #fff, transparent),
                radial-gradient(1px 1px at 130px 80px, rgba(255, 255, 255, 0.6), transparent),
                radial-gradient(2px 2px at 160px 30px, #ddd, transparent);
            background-repeat: repeat;
            background-size: 200px 100px;
            animation: moveStars 20s linear infinite;
            pointer-events: none;
            z-index: 0;
        }

        /* Light Mode - White Sky with Black Stars */
        body.light-mode::before {
            background:
                radial-gradient(2px 2px at 20px 30px, #000, transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(0, 0, 0, 0.8), transparent),
                radial-gradient(1px 1px at 90px 40px, #000, transparent),
                radial-gradient(1px 1px at 130px 80px, rgba(0, 0, 0, 0.6), transparent),
                radial-gradient(2px 2px at 160px 30px, #333, transparent);
        }

        /* Christmas Mode Styles */
        body.christmas-mode {
            background: #283747;
            /* Dark blue background for night sky */
            color: #f9f9f9;
            background-attachment: fixed;
            /* This creates the "sinking" effect */
            background-size: cover;
            /* Ensure background covers the entire viewport */
            background-position: center center;
            /* Center the background image */
        }

        body.christmas-mode::before {
            background:
                url('https://www.transparenttextures.com/patterns/christmas-eves.png') repeat,
                /* Snow pattern */
                radial-gradient(circle at 15% 15%, rgba(255, 255, 255, 0.4) 1px, transparent 60px),
                radial-gradient(circle at 70% 80%, rgba(255, 255, 255, 0.3) 1px, transparent 40px),
                radial-gradient(circle at 40% 50%, rgba(255, 255, 255, 0.5) 1px, transparent 80px);
            background-size: 200px 200px, cover, cover, cover, cover;
            animation: snowfall 30s linear infinite;
        }

        @keyframes snowfall {
            0% {
                background-position: 0 0, 0 0, 0 0, 0 0, 0 0;
            }

            100% {
                background-position: 0 200px, 0 200px, 0 200px, 0 200px, 0 200px;
            }
        }

        body.christmas-mode::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(4px 4px at 30px 40px, #fff, transparent),
                radial-gradient(3px 3px at 80px 10px, rgba(255, 255, 255, 0.8), transparent),
                radial-gradient(5px 5px at 120px 60px, #ddd, transparent),
                radial-gradient(2px 2px at 180px 90px, rgba(255, 255, 255, 0.6), transparent),
                radial-gradient(6px 6px at 200px 20px, #eee, transparent);
            background-repeat: repeat;
            background-size: 180px 180px;
            /* Adjust size for more varied flakes */
            animation: moveSnowflakes 25s linear infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes moveSnowflakes {
            0% {
                transform: translateY(0px);
                opacity: 1;
            }

            50% {
                opacity: 0.8;
            }

            100% {
                transform: translateY(200px);
                opacity: 0;
            }
        }

        @keyframes moveStars {
            0% {
                transform: translateX(0px) translateY(0px);
            }

            100% {
                transform: translateX(-200px) translateY(-100px);
            }
        }

        /* Additional star layers for depth */
        body::after {
            content: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(1px 1px at 50px 50px, #fff, transparent),
                radial-gradient(1px 1px at 100px 100px, rgba(255, 255, 255, 0.8), transparent),
                radial-gradient(1px 1px at 150px 150px, #ddd, transparent),
                radial-gradient(1px 1px at 200px 200px, rgba(255, 255, 255, 0.6), transparent);
            background-repeat: repeat;
            background-size: 300px 200px;
            animation: moveStars2 30s linear infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes moveStars2 {
            0% {
                transform: translateX(0px) translateY(0px);
            }

            100% {
                transform: translateX(-300px) translateY(-200px);
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 10;
        }

        header {
            background: var(--header-bg);
            color: var(--text-light);
            border: 1.5px solid var(--card-border);
            border-radius: 18px;
            padding: 8px 0;
            margin-bottom: 40px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(3px) saturate(160%);
            -webkit-backdrop-filter: blur(3px) saturate(160%);
            text-align: center;
            position: relative;
            z-index: 2;
        }

        .light-theme header {
            box-shadow: 0 10px 28px rgba(15, 23, 42, 0.10);
        }

        /* Fallback for browsers that don't support backdrop-filter */
        @supports not (backdrop-filter: blur(15px)) {
            header {
                background: var(--header-bg);
                box-shadow:
                    0 20px 40px rgba(0, 0, 0, 0.4),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2);
            }
        }

        h1 {
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--text-light);
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        .light-theme h1 {
            text-shadow: 0 0 18px rgba(0, 0, 0, 0.10);
        }

        .game-section {
            margin: 40px 0;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 600;
            color: var(--text-light);
            margin-bottom: 30px;
            text-align: center;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        }

        .light-theme .section-title {
            text-shadow: 0 0 14px rgba(0, 0, 0, 0.08);
        }

        .search-box {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 32px;
        }

        .search-input {
            background: var(--card-bg);
            border: 1.5px solid var(--card-border);
            border-radius: 12px;
            padding: 12px 20px;
            font-size: 1.1rem;
            color: var(--text-light);
            outline: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.10);
            backdrop-filter: blur(3px) saturate(160%);
            -webkit-backdrop-filter: blur(3px) saturate(160%);
            transition: border-color 0.2s, box-shadow 0.2s;
            width: 320px;
            max-width: 90vw;
        }

        .light-theme .search-input {
            box-shadow: 0 6px 16px rgba(15, 23, 42, 0.08);
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.72);
            opacity: 0.8;
        }

        .light-theme .search-input::placeholder {
            color: rgba(15, 23, 42, 0.55);
            opacity: 0.9;
        }

        .search-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 4px 16px rgba(78, 205, 196, 0.15);
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 32px;
            margin-top: 30px;
            overflow: visible !important;
        }

        .game-card {
            background: var(--card-bg);
            color: var(--text-light);
            border: 1.5px solid var(--card-border);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.22, 1, 0.36, 1), transform 0.25s cubic-bezier(0.22, 1, 0.36, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(3px) saturate(160%);
            -webkit-backdrop-filter: blur(3px) saturate(160%);
            text-decoration: none;
        }

        .light-theme .game-card {
            box-shadow: 0 10px 22px rgba(15, 23, 42, 0.10);
        }

        .game-card:hover,
        .game-card:focus-visible {
            background: rgba(255, 255, 255, 0.18);
            border-color: var(--primary-color);
            transform: scale(1.08);
            z-index: 10;
        }

        .light-theme .game-card:hover,
        .light-theme .game-card:focus-visible {
            background: rgba(15, 23, 42, 0.03);
        }

        .game-card:active {
            transform: scale(0.98);
        }

        .game-card::after,
        .game-card:hover::after {
            display: none !important;
        }

        .game-card p {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0;
            transition: color 0.3s ease;
        }

        .game-card:hover p {
            color: var(--primary-color);
            text-shadow: 0 0 10px rgba(78, 205, 196, 0.5);
        }

        .light-theme .game-card:hover p {
            text-shadow: 0 0 12px rgba(37, 99, 235, 0.25);
        }

        .divider {
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
            margin: 40px 0;
            border-radius: 2px;
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.5);
        }

        /* Floating animation for cards */
        /* .game-card:nth-child(odd) { animation: float 6s ease-in-out infinite; } */
        /* .game-card:nth-child(even) { animation: float 6s ease-in-out infinite reverse; } */
        /* @keyframes float { ... } */

        /* Glow effect for header */
        header::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(78, 205, 196, 0.2) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            border-radius: 50%;
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 0.5;
                transform: translate(-50%, -50%) scale(1);
            }

            50% {
                opacity: 0.8;
                transform: translate(-50%, -50%) scale(1.1);
            }
        }

        @media (max-width: 768px) {
            .game-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
            }

            h1 {
                font-size: 2.5rem;
            }

            .container {
                padding: 15px;
            }

            header {
                padding: 40px 0;
            }

            /* Prevent horizontal scroll on mobile */
            body {
                overflow-x: hidden;
                width: 100%;
            }
        }

        /* Toast notification styles */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 10000;
            pointer-events: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .toast.active {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* Dev Modal Styles */
        .dev-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10001;
        }

        .dev-modal.active {
            display: flex;
        }

        .dev-modal-content {
            background: rgba(78, 205, 196, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(78, 205, 196, 0.3);
            border-radius: 10px;
            padding: 20px;
            min-width: 300px;
            max-width: 90%;
            position: relative;
        }

        .dev-modal-content h3 {
            color: #0a0a0a;
            margin-bottom: 15px;
            text-align: center;
        }

        .dev-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .dev-options button {
            background: #4ecdc4;
            color: #0a0a0a;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .dev-options button:hover {
            background: #3bb8ae;
        }

        .dev-options button.danger {
            background: #ff4757;
            color: white;
        }

        .dev-options button.danger:hover {
            background: #ff3742;
        }

        .dev-modal .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: #4ecdc4;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
        }

        .dev-modal .close-btn:hover {
            color: #f9f9f9;
        }

        .widget-card {
            display: flex;
            flex-direction: column;
            align-items: stretch;
            justify-content: flex-start;
            text-align: left;
            gap: 12px;
            padding: 22px;
        }

        .widget-card:hover {
            background: rgba(255, 255, 255, 0.16);
            border-color: rgba(78, 205, 196, 0.55);
        }

        .widget-card .widget-body {
            width: 100%;
        }

        .widget-subtitle {
            font-size: 13px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.72);
            margin-top: -6px;
        }

        .widget-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .widget-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .widget-field {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .widget-field label {
            font-size: 11px;
            font-weight: 900;
            letter-spacing: 0.4px;
            color: rgba(255, 255, 255, 0.78);
            text-transform: uppercase;
        }

        .widget-input,
        .widget-select {
            width: 100%;
            padding: 10px 12px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            background: rgba(0, 0, 0, 0.35);
            color: rgba(255, 255, 255, 0.92);
            outline: none;
        }

        .widget-input:focus,
        .widget-select:focus {
            border-color: rgba(78, 205, 196, 0.6);
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.18);
        }

        .widget-progress {
            width: 100%;
            height: 10px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.10);
            border: 1px solid rgba(255, 255, 255, 0.14);
            overflow: hidden;
        }

        .widget-progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, rgba(78, 205, 196, 0.95), rgba(56, 189, 248, 0.95));
            border-radius: 999px;
            transition: width 0.25s ease;
        }

        .widget-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            font-size: 12px;
            font-weight: 800;
            color: rgba(255, 255, 255, 0.78);
        }

        .widget-pill {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 10px;
            border-radius: 999px;
            background: rgba(78, 205, 196, 0.12);
            border: 1px solid rgba(78, 205, 196, 0.25);
            font-weight: 900;
            color: rgba(255, 255, 255, 0.92);
        }

        .widget-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .widget-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 10px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.14);
            font-weight: 900;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.92);
        }

        .widget-badge.good {
            background: rgba(78, 205, 196, 0.12);
            border-color: rgba(78, 205, 196, 0.25);
        }

        .widget-badge.warn {
            background: rgba(255, 215, 0, 0.10);
            border-color: rgba(255, 215, 0, 0.22);
        }

        .widget-button {
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.16);
            background: rgba(255, 255, 255, 0.06);
            color: rgba(255, 255, 255, 0.92);
            border-radius: 12px;
            padding: 12px 12px;
            font-weight: 900;
            cursor: pointer;
            text-align: left;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .widget-button:hover {
            border-color: rgba(78, 205, 196, 0.55);
            background: rgba(78, 205, 196, 0.10);
        }

        .widget-button.danger {
            border-color: rgba(255, 71, 87, 0.55);
            background: rgba(255, 71, 87, 0.12);
        }

        .widget-button.danger:hover {
            border-color: rgba(255, 71, 87, 0.75);
            background: rgba(255, 71, 87, 0.18);
        }

        .widgets-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 14px;
        }

        .widgets-toolbar {
            display: inline-flex;
            gap: 10px;
        }

        .widgets-toolbar .widgets-mini-btn {
            width: auto;
            padding: 10px 12px;
            font-size: 13px;
            border-radius: 12px;
            white-space: nowrap;
        }

        .widget-remove {
            display: none;
            width: 32px;
            height: 32px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            background: rgba(0, 0, 0, 0.35);
            color: rgba(255, 255, 255, 0.95);
            font-weight: 900;
            cursor: pointer;
            align-items: center;
            justify-content: center;
        }

        .widgets-edit .widget-remove {
            display: inline-flex;
        }

        .widgets-edit .widget-header {
            touch-action: none;
            cursor: grab;
        }

        @keyframes widgetWiggle {
            0% {
                transform: rotate(-0.6deg);
            }

            50% {
                transform: rotate(0.6deg);
            }

            100% {
                transform: rotate(-0.6deg);
            }
        }

        .widgets-edit .game-card[data-widget-key] {
            animation: widgetWiggle 0.18s ease-in-out infinite;
            transform-origin: 50% 50%;
        }

        .game-card.widget-dragging {
            animation: none !important;
            box-shadow: 0 18px 44px rgba(0, 0, 0, 0.55) !important;
            border-color: rgba(78, 205, 196, 0.75) !important;
            background: rgba(0, 0, 0, 0.75) !important;
            cursor: grabbing;
        }

        .widget-placeholder {
            border: 2px dashed rgba(78, 205, 196, 0.55);
            border-radius: 18px;
            background: rgba(78, 205, 196, 0.06);
            min-height: 140px;
        }

        .widgets-modal {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.75);
            z-index: 10005;
        }

        .widgets-modal.active {
            display: flex;
        }

        .widgets-modal-content {
            width: min(540px, 92vw);
            max-height: min(720px, 86vh);
            overflow: hidden;
            border-radius: 16px;
            background: rgba(10, 10, 10, 0.88);
            border: 1px solid rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            box-shadow: 0 22px 60px rgba(0, 0, 0, 0.6);
        }

        .widgets-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 14px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.10);
        }

        .widgets-modal-title {
            font-weight: 900;
            color: rgba(255, 255, 255, 0.92);
            letter-spacing: 0.3px;
        }

        .widgets-modal-close {
            width: 36px;
            height: 36px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.16);
            background: rgba(255, 255, 255, 0.06);
            color: rgba(255, 255, 255, 0.92);
            font-weight: 900;
            cursor: pointer;
        }

        .widgets-modal-body {
            padding: 14px 14px 18px;
            overflow: auto;
            max-height: calc(min(720px, 86vh) - 64px);
        }

        .widget-picker-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            padding: 12px;
            border-radius: 14px;
            border: 1px solid rgba(255, 255, 255, 0.12);
            background: rgba(255, 255, 255, 0.05);
            margin-bottom: 10px;
        }

        .widget-picker-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .widget-picker-icon {
            width: 34px;
            height: 34px;
            border-radius: 12px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: rgba(78, 205, 196, 0.16);
            border: 1px solid rgba(78, 205, 196, 0.30);
        }

        .widget-picker-name {
            font-weight: 900;
            color: rgba(255, 255, 255, 0.92);
        }

        .widget-picker-desc {
            font-size: 12px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.70);
            margin-top: 2px;
        }

        .widget-picker-toggle {
            transform: scale(1.2);
        }

        .widget-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .widget-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 800;
            letter-spacing: 0.3px;
            color: rgba(255, 255, 255, 0.92);
            font-size: 16px;
        }

        .widget-title .widget-icon {
            width: 30px;
            height: 30px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            background: rgba(78, 205, 196, 0.18);
            border: 1px solid rgba(78, 205, 196, 0.35);
            color: rgba(255, 255, 255, 0.95);
            font-size: 16px;
        }

        .widget-body {
            color: rgba(255, 255, 255, 0.88);
            font-size: 14px;
            line-height: 1.35;
        }

        .pet-avatar {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 64px;
            height: 64px;
            border-radius: 18px;
            background: rgba(78, 205, 196, 0.12);
            border: 1px solid rgba(78, 205, 196, 0.35);
            margin-bottom: 10px;
            transform-origin: center;
            transition: transform 0.25s ease;
            font-size: 34px;
        }

        .pet-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
        }

        .pet-stat {
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.10);
            border-radius: 10px;
            padding: 8px;
        }

        .pet-stat .label {
            display: block;
            font-size: 11px;
            font-weight: 800;
            color: rgba(255, 255, 255, 0.75);
            margin-bottom: 2px;
        }

        .pet-stat .value {
            display: block;
            font-size: 14px;
            font-weight: 900;
            color: rgba(255, 255, 255, 0.95);
        }

        .widget-links {
            display: grid;
            grid-template-columns: 1fr;
            gap: 6px;
        }

        .widget-link {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.16);
            background: rgba(255, 255, 255, 0.06);
            color: rgba(255, 255, 255, 0.92);
            border-radius: 10px;
            padding: 8px 10px;
            font-weight: 800;
            cursor: pointer;
        }

        .widget-link:hover {
            border-color: rgba(78, 205, 196, 0.55);
            background: rgba(78, 205, 196, 0.10);
        }
    </style>
</head>

<body>

    <!-- IMMEDIATE GLOBAL RESET FUNCTION - Available right away in console -->
    <script>
        window.resetStreakData = function () {
            console.log('üîÑ Resetting ALL streak data...');

            try {
                // Clear all streak-related localStorage
                localStorage.removeItem('streakDataV2');
                localStorage.removeItem('streakFreezes');
                localStorage.removeItem('bestStreak');
                localStorage.removeItem('streakRestoration_v1'); // Also clear restoration flag for testing

                // Reset display if element exists
                const streakNumber = document.getElementById('streakNumber');
                if (streakNumber) {
                    streakNumber.textContent = '0';
                }

                console.log('‚úÖ Streak data completely reset!');
                console.log('üîÑ All localStorage keys cleared');
                console.log('üìä Display updated to show streak: 0');

                // Auto-refresh after a short delay to show the reset
                setTimeout(() => {
                    location.reload();
                }, 1000);

                return 'Streak reset complete! Page will refresh automatically...';
            } catch (error) {
                console.error('‚ùå Error resetting streak data:', error);
                return 'Error occurred while resetting streak data.';
            }
        };

        // Confirm function is available
        console.log('üîß resetStreakData() function loaded and ready!');
    </script>

    <canvas id="streakCanvas"></canvas>
    <div class="star-container" id="starContainer"></div>

    <!-- Settings button -->
    <button class="settings-btn" id="settingsBtn" title="Settings">
        ‚öôÔ∏è
        <div class="notification-dot"></div>
    </button>

    <!-- Streak display -->
    <div class="streak-display" id="streakDisplay" title="Daily Streak">
        <span id="streakNumber">0</span>
        <span class="flame">üî•</span>
        <div class="notification-dot"></div>
    </div>


    <!-- Settings menu -->
    <div class="settings-menu" id="settingsMenu">
        <button class="close-btn" id="closeSettings">√ó</button>
        <h3>Settings</h3>

        <div class="settings-option">
            <button id="openInjectionBtn"
                style="width: 100%; padding: 10px; background: #4ecdc4; color: #0a0a0a; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">
                Inject Into About:Blank
            </button>
        </div>

        <div class="settings-option" style="margin-top: 12px;">
            <label>
                Stars
                <div class="toggle-switch" id="starsToggle">
                    <input type="checkbox" id="starsCheckbox" style="display: none;">
                </div>
            </label>
        </div>

        <div class="settings-option">
            <label for="starsCount" style="display:block; margin-bottom: 6px;">Star Amount: <span
                    id="starsCountLabel">200</span></label>
            <input id="starsCount" type="range" min="50" max="500" step="10" value="200" style="width: 100%;" />
            <small style="color: #ffffff; font-size: 14px; font-weight: bold;">Does not work with seasonal
                backgrounds</small>
        </div>

        <div class="settings-option">
            <label for="starsSpeed" style="display:block; margin-bottom: 6px;">Star Speed</label>
            <select id="starsSpeed" style="width: 100%; padding: 8px; border-radius: 6px;">
                <option value="slow" selected>Slow</option>
                <option value="medium">Medium</option>
                <option value="fast">Fast</option>
            </select>
            <small style="color: #ffffff; font-size: 14px; font-weight: bold;">Does not work with seasonal
                backgrounds</small>
        </div>

        <div class="settings-option">
            <label for="starsColor" style="display:block; margin-bottom: 6px;">Star Color</label>
            <select id="starsColor" style="width: 100%; padding: 8px; border-radius: 6px;">
                <option value="multicolor">Multicolor</option>
                <option value="white" selected>White</option>
                <option value="blue">Blue</option>
                <option value="gold">Gold</option>
                <option value="pink">Pink</option>
                <option value="mint">Mint</option>
            </select>
            <small style="color: #ffffff; font-size: 14px; font-weight: bold;">Does not work with seasonal
                backgrounds</small>
        </div>

        <div class="settings-option">
            <button id="openBackgroundSettingsBtn"
                style="width: 100%; padding: 15px; background: rgba(255,255,255,0.2); color: #ffffff; border: 2px solid rgba(255,255,255,0.3); border-radius: 8px; cursor: pointer; font-weight: 700; font-size: 16px; position: relative; text-transform: uppercase; letter-spacing: 1px;">
                Background Settings
                <div class="notification-dot"
                    style="position: absolute; top: 10px; right: 10px; width: 14px; height: 14px; background: #ff4444; border-radius: 50%; border: 2px solid #0a0a0a; box-shadow: 0 0 8px rgba(255, 68, 68, 0.8);">
                </div>
            </button>
        </div>
    </div>

    <!-- Fullscreen button for mobile -->
    <button class="fullscreen-btn" id="fullscreenBtn" title="Toggle Fullscreen">
        <span id="fullscreenIcon">‚õ∂</span>
    </button>

    <div class="container">
        <header>
            <h1>Brayden is tall games 2</h1>
        </header>

        <div class="game-section">
            <div class="widgets-header">
                <h2 class="section-title" style="margin: 0;">Widgets</h2>
                <div class="widgets-toolbar">
                    <button class="widget-button widgets-mini-btn" id="widgetsEditBtn" type="button">Edit</button>
                    <button class="widget-button widgets-mini-btn" id="widgetsAddBtn" type="button">+ Add</button>
                </div>
            </div>

            <div class="game-grid" id="widgetsGrid">
                <div class="game-card widget-card" id="petWidgetCard" data-widget-key="pet">
                    <div class="widget-header">
                        <div class="widget-title">
                            <span class="widget-icon">üêæ</span>
                            <span>Streak Pet</span>
                        </div>
                        <button class="widget-remove" type="button" data-remove-widget="pet"
                            aria-label="Remove widget">√ó</button>
                    </div>
                    <div class="widget-subtitle" id="petSubtitle">Your pet grows with your streak</div>
                    <div class="widget-body">
                        <div class="pet-avatar" id="petAvatar">ü•ö</div>
                        <div class="pet-stats">
                            <div class="pet-stat">
                                <span class="label">Level</span>
                                <span class="value" id="petLevel">1</span>
                            </div>
                            <div class="pet-stat">
                                <span class="label">Streak</span>
                                <span class="value" id="petStreak">0</span>
                            </div>
                        </div>

                        <div style="margin-top: 12px;">
                            <div class="widget-meta">
                                <span id="petProgressText">0 / 3</span>
                                <span class="widget-pill" id="petNextText">Next: 3</span>
                            </div>
                            <div class="widget-progress" aria-hidden="true" style="margin-top: 8px;">
                                <div class="widget-progress-bar" id="petProgressBar"></div>
                            </div>
                        </div>

                        <div class="widget-controls" style="margin-top: 14px;">
                            <div class="widget-field">
                                <label for="petNameInput">Pet Name</label>
                                <input class="widget-input" id="petNameInput" type="text" maxlength="18"
                                    placeholder="Nova" />
                            </div>
                            <div class="widget-field">
                                <label for="petTypeSelect">Pet Type</label>
                                <select class="widget-select" id="petTypeSelect">
                                    <option value="bird" selected>Bird</option>
                                    <option value="cat">Cat</option>
                                    <option value="dragon">Dragon</option>
                                    <option value="slime">Slime</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="game-card widget-card" id="clockWidgetCard" data-widget-key="clock">
                    <div class="widget-header">
                        <div class="widget-title">
                            <span class="widget-icon">üïí</span>
                            <span>Clock</span>
                        </div>
                        <button class="widget-remove" type="button" data-remove-widget="clock"
                            aria-label="Remove widget">√ó</button>
                    </div>
                    <div class="widget-body" style="font-weight: 900; font-size: 18px;" id="clockTime">--:--</div>
                    <div class="widget-body" style="opacity: 0.85;" id="clockDate">---</div>
                </div>

                <div class="game-card widget-card" id="statsWidgetCard" data-widget-key="stats">
                    <div class="widget-header">
                        <div class="widget-title">
                            <span class="widget-icon">üìà</span>
                            <span>Streak Stats</span>
                        </div>
                        <button class="widget-remove" type="button" data-remove-widget="stats"
                            aria-label="Remove widget">√ó</button>
                    </div>
                    <div class="widget-subtitle">Quick overview</div>
                    <div class="widget-body">
                        <div class="widget-badges" style="margin-bottom: 12px;">
                            <div class="widget-badge good" id="coinsBadge">Coins: <span id="coinsAmount">0</span></div>
                            <div class="widget-badge" id="achievementsBadge">Achievements: <span
                                    id="achievementsUnlocked">0</span>/<span id="achievementsTotal">0</span></div>
                        </div>
                        <div class="pet-stats">
                            <div class="pet-stat">
                                <span class="label">Current</span>
                                <span class="value" id="statsCurrent">0</span>
                            </div>
                            <div class="pet-stat">
                                <span class="label">Best</span>
                                <span class="value" id="statsBest">0</span>
                            </div>
                            <div class="pet-stat">
                                <span class="label">Freezes</span>
                                <span class="value" id="statsFreezes">0</span>
                            </div>
                            <div class="pet-stat">
                                <span class="label">Pet</span>
                                <span class="value" id="statsPetName">‚Äî</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="game-card widget-card" id="dailyWidgetCard" data-widget-key="daily">
                    <div class="widget-header">
                        <div class="widget-title">
                            <span class="widget-icon">üéÅ</span>
                            <span>Daily Reward</span>
                        </div>
                        <button class="widget-remove" type="button" data-remove-widget="daily"
                            aria-label="Remove widget">√ó</button>
                    </div>
                    <div class="widget-subtitle" id="dailyStatus">Ready to claim</div>
                    <div class="widget-body">
                        <div class="widget-badges" style="margin-bottom: 12px;">
                            <div class="widget-badge good">Reward: <span id="dailyRewardAmount">0</span> coins</div>
                            <div class="widget-badge">Bonus: +<span id="dailyBonus">0</span></div>
                        </div>
                        <button class="widget-button" id="claimDailyBtn" type="button">
                            <span>Claim Reward</span>
                            <span>+</span>
                        </button>
                    </div>
                </div>

                <div class="game-card widget-card" id="achievementsWidgetCard" data-widget-key="achievements">
                    <div class="widget-header">
                        <div class="widget-title">
                            <span class="widget-icon">üèÜ</span>
                            <span>Achievements</span>
                        </div>
                        <button class="widget-remove" type="button" data-remove-widget="achievements"
                            aria-label="Remove widget">√ó</button>
                    </div>
                    <div class="widget-subtitle" id="achievementsNext">Next: ‚Äî</div>
                    <div class="widget-body">
                        <div class="widget-badges" id="achievementsList"></div>
                    </div>
                </div>

                <div class="game-card widget-card" id="actionsWidgetCard" data-widget-key="actions">
                    <div class="widget-header">
                        <div class="widget-title">
                            <span class="widget-icon">‚ö°</span>
                            <span>Quick Actions</span>
                        </div>
                        <button class="widget-remove" type="button" data-remove-widget="actions"
                            aria-label="Remove widget">√ó</button>
                    </div>
                    <div class="widget-subtitle">Tools</div>
                    <div class="widget-body">
                        <div class="widget-links">
                            <button class="widget-button" id="openStreaksBtn" type="button">
                                <span>Open Streaks</span>
                                <span>‚Üí</span>
                            </button>
                            <button class="widget-button" id="resetPetBtn" type="button">
                                <span>Reset Pet</span>
                                <span>‚ü≤</span>
                            </button>
                            <button class="widget-button danger" id="resetDashboardBtn" type="button">
                                <span>Reset Dashboard Data</span>
                                <span>!</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="game-card widget-card" id="streaksWidgetCard" data-widget-key="streaks">
                    <div class="widget-header">
                        <div class="widget-title">
                            <span class="widget-icon">üî•</span>
                            <span>Streaks</span>
                        </div>
                        <button class="widget-remove" type="button" data-remove-widget="streaks"
                            aria-label="Remove widget">√ó</button>
                    </div>
                    <div class="widget-body">
                        Open your streak calendar and progress.
                    </div>

                    <div class="widget-body" style="margin-top: 12px;">
                        <button class="widget-button" id="openStreaksCardBtn" type="button">
                            <span>Open</span>
                            <span>‚Üí</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="widgets-modal" id="widgetsModal" aria-hidden="true">
                <div class="widgets-modal-content">
                    <div class="widgets-modal-header">
                        <div class="widgets-modal-title">Choose Widgets</div>
                        <button class="widgets-modal-close" id="widgetsModalClose" type="button">√ó</button>
                    </div>
                    <div class="widgets-modal-body" id="widgetsModalList"></div>
                </div>
            </div>
        </div>

        <div class="game-section">
            <h2 class="section-title">Game list</h2>

            <div class="search-box">
                <input class="search-input" type="text" placeholder="Search games..." />
            </div>

            <div class="game-grid">
                <a class="game-card" href="ant-escape.html">
                    <p>Ant Escape</p>
                </a>
                <a class="game-card" href="crazy-cattle-3d.html">
                    <p>Crazy cattle 3d</p>
                </a>
                <a class="game-card" href="crazy-chicken-3d.html">
                    <p>Crazy chicken 3D</p>
                </a>
                <!-- Removed: Crazy kitty 3D -->
                <a class="game-card" href="curve-rush.html">
                    <p>Curve Rush</p>
                </a>
                <a class="game-card" href="slender-multiplayer.html">
                    <p>Slender Multiplayer</p>
                </a>
                <a class="game-card" href="escape-road-2.html">
                    <p>Escape Road 2</p>
                </a>
                <a class="game-card" href="cars.html">
                    <p>Cars</p>
                </a>
                <a class="game-card" href="drive-mad.html">
                    <p>Drive mad</p>
                </a>
                <!-- Removed: Shell shockers -->
                <a class="game-card" href="basketball-stars.html">
                    <p>Basketball stars</p>
                </a>
                <!-- Removed: Minecraft -->
                <!-- Removed: OVO -->
                <a class="game-card" href="smash-karts.html">
                    <p>Smash karts</p>
                </a>
                <a class="game-card" href="crossy-road.html">
                    <p>Crossy Road</p>
                </a>
                <a class="game-card" href="1v1-lol.html">
                    <p>1v1.lol</p>
                </a>
                <a class="game-card" href="speed-stars.html">
                    <p>Speed Stars</p>
                </a>
                <a class="game-card" href="ragdoll-archers.html">
                    <p>Ragdoll Archers</p>
                </a>
                <a class="game-card" href="cookie-clicker.html">
                    <p>Cookie clicker</p>
                </a>

                <a class="game-card" href="slow-roads.html">
                    <p>slow roads</p>
                </a>
                <!-- Removed: Escape Road -->
                <a class="game-card" href="golf-orbit.html">
                    <p>Golf Orbit</p>
                </a>
                <a class="game-card" href="traffic-road.html">
                    <p>Traffic Road</p>
                </a>
                <!-- Removed: Wave Dash -->
                <a class="game-card" href="ragdoll-hit-stickman.html">
                    <p>Ragdoll Hit Stickman</p>
                </a>

                <!-- Removed: Chill Guy Clicker -->

                <a class="game-card" href="granny.html">
                    <p>Granny</p>
                </a>

                <a class="game-card" href="cowboy-safari.html">
                    <p>Cowboy Safari</p>
                </a>

                <a class="game-card" href="slope-rider.html">
                    <p>Slope Rider</p>
                </a>

                <a class="game-card" href="ramp-xtreme.html">
                    <p>Ramp Xtreme</p>
                </a>

                <a class="game-card" href="geometry-lite.html">
                    <p>Geometry Lite</p>
                </a>
                <a class="game-card" href="arcade-tennis.html">
                    <p>Arcade Tennis</p>
                </a>
            </div>
        </div>
    </div>
    </div>

    <!-- Streak functionality -->
    <script>
        // Global toast function - must be defined before other functions
        window.showToast = function (message) {
            const toast = document.getElementById('toast');
            if (!toast) return;
            toast.textContent = message;
            toast.classList.add('active');
            window.setTimeout(() => toast.classList.remove('active'), 3500);
        };

        const STORAGE_KEY_V2 = 'streakDataV2';

        // --- SECURITY ---
        const Obfuscator = (() => {
            const BASE_KEY = "STREAK_SECURE_KEY_V1";

            // RC4 Stream Cipher Implementation
            function rc4(key, str) {
                const s = [], res = [];
                let i, j, x, y;

                // KSA (Key-Scheduling Algorithm)
                for (i = 0; i < 256; i++) {
                    s[i] = i;
                }
                for (i = 0, j = 0; i < 256; i++) {
                    j = (j + s[i] + key.charCodeAt(i % key.length)) % 256;
                    x = s[i];
                    s[i] = s[j];
                    s[j] = x;
                }

                // PRGA (Pseudo-Random Generation Algorithm)
                i = 0;
                j = 0;
                for (y = 0; y < str.length; y++) {
                    i = (i + 1) % 256;
                    j = (j + s[i]) % 256;
                    x = s[i];
                    s[i] = s[j];
                    s[j] = x;
                    res.push(String.fromCharCode(str.charCodeAt(y) ^ s[(s[i] + s[j]) % 256]));
                }
                return res.join("");
            }

            function djb2(str) {
                let hash = 5381;
                for (let i = 0; i < str.length; i++) {
                    hash = ((hash << 5) + hash) + str.charCodeAt(i);
                }
                return hash;
            }

            function generateSalt(length) {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
                let salt = '';
                for (let i = 0; i < length; i++) {
                    salt += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return salt;
            }

            return {
                encrypt: (dataObj) => {
                    try {
                        const json = JSON.stringify(dataObj);
                        const checksum = djb2(json);
                        const payload = `${json}|${checksum}`;

                        // Generates a new random salt every time
                        const salt = generateSalt(4);
                        const key = BASE_KEY + salt;

                        const encrypted = rc4(key, payload);
                        // Prepend salt to the output so we can use it for decryption
                        return btoa(salt + encrypted);
                    } catch (e) { console.error('Encrypt failed', e); return null; }
                },
                decrypt: (base64Str) => {
                    try {
                        const raw = atob(base64Str);

                        // Extract the 4-char salt
                        const salt = raw.substring(0, 4);
                        const encrypted = raw.substring(4);

                        const key = BASE_KEY + salt;
                        const decrypted = rc4(key, encrypted);

                        const lastPipe = decrypted.lastIndexOf('|');
                        if (lastPipe === -1) throw new Error('Invalid payload format');

                        const json = decrypted.substring(0, lastPipe);
                        const storedChecksum = parseInt(decrypted.substring(lastPipe + 1));

                        if (djb2(json) !== storedChecksum) throw new Error('Checksum mismatch');

                        return JSON.parse(json);
                    } catch (e) {
                        console.error('Decrypt failed - Tampering output or format error', e);
                        return null;
                    }
                }
            };
        })();

        function validateStreakData(data) {
            if (data.freezes < 0 || data.freezes > 1000) return false;
            if (data.best < 0 || data.best > 10000) return false;
            if (!Array.isArray(data.visits) || !Array.isArray(data.usedFreezes)) return false;

            const visitSet = new Set(data.visits);
            if (visitSet.size !== data.visits.length) return false;

            const now = new Date();
            const maxFutureDays = 1;
            for (const visit of data.visits) {
                try {
                    const visitDate = parseDayKey(visit);
                    if (!visitDate) return false;
                    if (visitDate > new Date(now.getTime() + maxFutureDays * 24 * 60 * 60 * 1000)) return false;
                } catch {
                    return false;
                }
            }

            for (const freeze of data.usedFreezes) {
                try {
                    const freezeDate = parseDayKey(freeze);
                    if (!freezeDate) return false;
                } catch {
                    return false;
                }
            }

            return true;
        }

        function normalizeToNoon(date) {
            const d = new Date(date);
            d.setHours(12, 0, 0, 0);
            return d;
        }

        function toDayKey(date) {
            const d = normalizeToNoon(date);
            const y = d.getFullYear();
            const m = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return `${y}-${m}-${day}`;
        }

        function parseDayKey(key) {
            if (!key) return null;
            if (/^\d{4}-\d{2}-\d{2}$/.test(key)) {
                const d = new Date(`${key}T12:00:00`);
                return Number.isNaN(d.getTime()) ? null : normalizeToNoon(d);
            }
            const legacy = new Date(key);
            return Number.isNaN(legacy.getTime()) ? null : normalizeToNoon(legacy);
        }

        function normalizeDayKey(value) {
            const parsed = parseDayKey(value);
            return parsed ? toDayKey(parsed) : null;
        }

        function mergeDayKeys(existing, add) {
            const set = new Set((existing || []).map(normalizeDayKey).filter(Boolean));
            const incoming = Array.isArray(add) ? add : [add];
            incoming.map(normalizeDayKey).filter(Boolean).forEach(k => set.add(k));
            return Array.from(set).sort();
        }

        function getWeekKey(date) {
            const d = normalizeToNoon(date);
            const day = d.getDay();
            const diffToMonday = (day + 6) % 7;
            const monday = new Date(d);
            monday.setDate(d.getDate() - diffToMonday);
            monday.setHours(12, 0, 0, 0);
            return toDayKey(monday);
        }


        function loadV2() {
            let parsed = null;
            try {
                const stored = localStorage.getItem(STORAGE_KEY_V2);
                if (stored) {
                    // Try decrypting first
                    if (typeof Obfuscator !== 'undefined') {
                        parsed = Obfuscator.decrypt(stored);
                    }
                    // Fallback to plain JSON if decryption failed or not ready
                    if (!parsed && stored.startsWith('{')) {
                        parsed = JSON.parse(stored);
                    }
                }
            } catch {
                parsed = null;
            }

            const base = {
                version: 2,
                visits: [],
                freezes: Number(localStorage.getItem('streakFreezes') || 0) || 0,
                usedFreezes: [],
                lastFreezeWeek: null,
                best: Number(localStorage.getItem('bestStreak') || 0) || 0,
                checksum: null
            };

            if (!parsed || typeof parsed !== 'object') return base;

            let loadedData = {
                ...base,
                version: 2,
                visits: Array.isArray(parsed.visits) ? parsed.visits : base.visits,
                freezes: Number.isFinite(parsed.freezes) ? parsed.freezes : base.freezes,
                usedFreezes: Array.isArray(parsed.usedFreezes) ? parsed.usedFreezes : base.usedFreezes,
                lastFreezeWeek: typeof parsed.lastFreezeWeek === 'string' ? parsed.lastFreezeWeek : base.lastFreezeWeek,
                best: Number.isFinite(parsed.best) ? parsed.best : base.best,
                checksum: parsed.checksum || null
            };

            if (!validateStreakData(loadedData)) {
                localStorage.removeItem(STORAGE_KEY_V2);
                localStorage.removeItem('streakFreezes');
                localStorage.removeItem('bestStreak');
                return base;
            }

            return loadedData;
        }

        function saveV2(data) {
            if (!validateStreakData(data)) {
                return;
            }

            try {
                if (typeof Obfuscator !== 'undefined') {
                    const secure = Obfuscator.encrypt(data);
                    localStorage.setItem(STORAGE_KEY_V2, secure);
                } else {
                    localStorage.setItem(STORAGE_KEY_V2, JSON.stringify(data));
                }
            } catch (e) {
                console.error('Save failed', e);
            }

            localStorage.setItem('streakFreezes', String(data.freezes));
            localStorage.setItem('bestStreak', String(data.best));
        }

        function migrateLegacyIntoV2(data) {
            const practiced = (() => {
                try {
                    return JSON.parse(localStorage.getItem('practicedDays') || '[]');
                } catch {
                    return [];
                }
            })();

            const used = (() => {
                try {
                    return JSON.parse(localStorage.getItem('usedFreezes') || '[]');
                } catch {
                    return [];
                }
            })();

            data.visits = mergeDayKeys(data.visits, practiced);
            data.usedFreezes = mergeDayKeys(data.usedFreezes, used);

            return data;
        }

        function recordVisit(data, date = new Date()) {
            const today = normalizeToNoon(date);
            const key = toDayKey(today);
            data.visits = mergeDayKeys(data.visits, key);

            if (today.getDay() === 1) {
                const weekKey = getWeekKey(today);
                console.log(`üìÖ Monday detected! Current week: ${weekKey}, Last freeze week: ${data.lastFreezeWeek}`);
                if (data.lastFreezeWeek !== weekKey) {
                    data.freezes = Math.max(0, Number(data.freezes) || 0) + 1;
                    data.lastFreezeWeek = weekKey;
                    console.log(`‚ùÑÔ∏è Monday bonus: +1 Freeze (Total: ${data.freezes})`);
                    showToast('Monday bonus: +1 Freeze');
                } else {
                    console.log('‚ùÑÔ∏è Monday bonus already claimed this week');
                }
            } else {
                console.log(`üìÖ Day ${today.getDay()} (not Monday, no freeze)`);
            }

            return data;
        }

        // Compute the set of used-freeze day keys that should be considered "valid"
        // for display and calendar rendering. This simulates the forward walk used
        // by `computeStreak` to ensure visual consistency.
        function computeEffectiveUsedSet(data, date = new Date()) {
            const today = normalizeToNoon(date);
            const visitsSet = new Set((data.visits || []).map(normalizeDayKey).filter(Boolean));
            const originalUsedSet = new Set((data.usedFreezes || []).map(normalizeDayKey).filter(Boolean));
            const originalUsedCount = originalUsedSet.size;

            // 1. Determine the "Active Window".
            // Instead of a hard 30-day cut, find the earliest relevant activity.
            // Scan back until we find a gap > 30 days to ensure we catch the true start.
            let allDates = [...data.visits, ...data.usedFreezes].map(k => parseDayKey(k)).filter(d => d && d <= today);
            if (allDates.length === 0) return new Set();

            // Sort dates ascending
            allDates.sort((a, b) => a - b);
            const firstDate = allDates[0];

            // Start simulation from the first ever relevant date found, or 365 days back, whichever is earlier.
            const startLimit = new Date(today);
            startLimit.setDate(today.getDate() - 365);

            let cursor = new Date(firstDate < startLimit ? firstDate : startLimit);
            cursor = normalizeToNoon(cursor);

            // Total available freezes (current + historically used)
            let available = (Number.isFinite(data.freezes) ? data.freezes : (data.freezes || 0)) + originalUsedCount;

            const effectiveUsed = new Set();
            let streakActive = false;

            while (cursor <= today) {
                const key = toDayKey(cursor);
                const dow = cursor.getDay();
                const isWeekend = dow === 0 || dow === 6;

                const hasVisit = visitsSet.has(key);
                const hasOrigUsed = originalUsedSet.has(key);

                if (hasVisit) {
                    // Green Day
                    streakActive = true;
                    // Green overrides Blue, so we do nothing with freeezes
                } else if (!isWeekend && streakActive) {
                    // Missed Weekday inside Active Streak (Zone B)
                    // This is the ONLY place a freeze can occur.

                    if (hasOrigUsed) {
                        // User previously marked this as used. Verify we can afford it.
                        effectiveUsed.add(key);
                        available = Math.max(0, available - 1);
                    } else if (available > 0) {
                        // Auto-consume if available to keep streak alive
                        effectiveUsed.add(key);
                        available -= 1;
                    } else {
                        // No freezes left -> Streak Breaks
                        streakActive = false;
                    }
                } else {
                    // Zone A (Before Start), Inactive, or Weekend
                    if (!isWeekend) {
                        // If it's a weekday and we are NOT active, ensure we stay inactive.
                        streakActive = false;
                    }
                }

                cursor.setDate(cursor.getDate() + 1);
                cursor.setHours(12, 0, 0, 0);
            }

            return effectiveUsed;
        }

        function computeStreak(data, date = new Date()) {
            const today = normalizeToNoon(date);

            const visits = new Set((data.visits || []).map(normalizeDayKey).filter(Boolean));
            const originalUsedSet = new Set((data.usedFreezes || []).map(normalizeDayKey).filter(Boolean));
            const originalFreezes = Number.isFinite(data.freezes) ? Number(data.freezes) : (data.freezes || 0);

            const effectiveUsedSet = computeEffectiveUsedSet({
                visits: Array.from(visits),
                usedFreezes: Array.from(originalUsedSet),
                freezes: originalFreezes
            }, today);

            let streak = 0;
            let streakActive = false;

            const cursor = new Date(today);
            cursor.setHours(12, 0, 0, 0);

            while (true) {
                const key = toDayKey(cursor);
                const dow = cursor.getDay();
                const isWeekend = dow === 0 || dow === 6;

                const hasVisit = visits.has(key);
                const hasUsed = effectiveUsedSet.has(key);

                console.log(`Checking ${key}: weekday=${!isWeekend}, visit=${hasVisit}, freeze=${hasUsed}, active=${streakActive}`);

                if (hasVisit) {
                    streak += 1;
                    streakActive = true;
                } else if (hasUsed && streakActive) {
                    streak += 1;
                } else if (!isWeekend && streakActive) {
                    console.log(`  -> Break streak, no freeze available`);
                    break;
                } else {
                    if (!isWeekend) break;
                }

                cursor.setDate(cursor.getDate() - 1);
                cursor.setHours(12, 0, 0, 0);
                if (getDayDiff(cursor, today) > 365) break;
            }

            const effectiveCount = effectiveUsedSet.size;
            const originalUsedCount = originalUsedSet.size;
            data.freezes = Math.max(0, originalFreezes - (effectiveCount - originalUsedCount));
            data.usedFreezes = Array.from(effectiveUsedSet).sort();

            data.best = Math.max(Number(data.best) || 0, streak);
            return { streak, data };
        }


        function calculateActiveStreak(data) {
            const today = normalizeToNoon(new Date());
            const visits = new Set((data.visits || []).map(normalizeDayKey).filter(Boolean));
            const used = computeEffectiveUsedSet(data, today);

            let activeStreak = 0;
            let streakActive = false;

            const cursor = new Date(today);
            cursor.setHours(12, 0, 0, 0);

            while (true) {
                const key = toDayKey(cursor);
                const dow = cursor.getDay();
                const isWeekend = dow === 0 || dow === 6;

                if (visits.has(key)) {
                    // Green day - counts as active
                    activeStreak += 1;
                    streakActive = true;
                } else if (!isWeekend && used.has(key) && streakActive) {
                    // Blue day - counts as active
                    activeStreak += 1;
                } else if (!isWeekend && !visits.has(key) && !used.has(key)) {
                    // Missed weekday without freeze - break active streak
                    break;
                }
                // Weekends don't count toward active streak but don't break it

                cursor.setDate(cursor.getDate() - 1);
                cursor.setHours(12, 0, 0, 0);

                if (getDayDiff(cursor, today) > 365) break;
            }

            return activeStreak;
        }

        function getDayDiff(a, b) {
            const msPerDay = 1000 * 60 * 60 * 24;
            const start = normalizeToNoon(a);
            const end = normalizeToNoon(b);
            return Math.round((end - start) / msPerDay);
        }


        document.addEventListener('DOMContentLoaded', function () {
            let data = loadV2();
            data = migrateLegacyIntoV2(data);
            data = recordVisit(data, new Date());
            const computed = computeStreak(data, new Date());
            data = computed.data;
            saveV2(data);

            const streakNumber = document.getElementById('streakNumber');
            const streakDisplay = document.getElementById('streakDisplay');

            console.log('Streak data loaded:', { streak: computed.streak, data: data });
            console.log('Visits:', data.visits);
            console.log('Used freezes:', data.usedFreezes);
            console.log('Available freezes:', data.freezes);

            if (streakNumber) {
                // Calculate active days (weekdays with visits or freezes) for display
                const activeStreak = calculateActiveStreak(data);
                streakNumber.textContent = String(activeStreak);
                console.log('Streak number updated to:', activeStreak);
                if (typeof window.updatePetWidget === 'function') {
                    window.updatePetWidget(activeStreak);
                }
            } else {
                console.error('Streak number element not found');
            }

            if (streakDisplay) {
                // Remove any existing event listeners to prevent duplicates
                streakDisplay.removeEventListener('click', handleStreakClick);
                // Add the click event listener
                streakDisplay.addEventListener('click', handleStreakClick);
                streakDisplay.style.cursor = 'pointer';
                streakDisplay.style.pointerEvents = 'auto';
                console.log('Streak display click listener added');
            } else {
                console.error('Streak display element not found');
            }
        });

        // Define the click handler function separately to avoid duplication
        function handleStreakClick() {
            console.log('Streak display clicked, navigating to streaks.html');
            window.location.href = 'streaks.html';
        }

        // Also set up the click listener immediately in case DOMContentLoaded already fired
        function setupStreakButton() {
            const streakDisplay = document.getElementById('streakDisplay');
            if (streakDisplay) {
                streakDisplay.removeEventListener('click', handleStreakClick);
                streakDisplay.addEventListener('click', handleStreakClick);
                streakDisplay.style.cursor = 'pointer';
                streakDisplay.style.pointerEvents = 'auto';
                console.log('Streak button setup completed');
            }
        }

        // Try to set up immediately and also when DOM is ready
        setupStreakButton();

        // Periodic check to ensure streak button remains functional
        setInterval(function () {
            const streakDisplay = document.getElementById('streakDisplay');
            const streakNumber = document.getElementById('streakNumber');

            if (streakDisplay && !streakDisplay.onclick) {
                setupStreakButton();
                console.log('Streak button re-attached');
            }

            // Ensure the streak number is not stuck at 0 incorrectly
            if (streakNumber && streakNumber.textContent === '0') {
                // Try to reload and update the streak data
                try {
                    let data = loadV2();
                    data = migrateLegacyIntoV2(data);
                    const computed = computeStreak(data, new Date());
                    if (computed.streak > 0) {
                        streakNumber.textContent = String(computed.streak);
                        console.log('Streak number corrected from 0 to:', computed.streak);
                        if (typeof window.updatePetWidget === 'function') {
                            window.updatePetWidget(Number(streakNumber.textContent) || 0);
                        }
                    }
                } catch (e) {
                    console.error('Error updating streak number:', e);
                }
            }
        }, 5000); // Check every 5 seconds
    </script>

    <script>
        function clamp(n, min, max) {
            return Math.max(min, Math.min(max, n));
        }

        function formatTime(d) {
            const h = d.getHours();
            const m = String(d.getMinutes()).padStart(2, '0');
            const h12 = ((h + 11) % 12) + 1;
            const ampm = h >= 12 ? 'PM' : 'AM';
            return `${h12}:${m} ${ampm}`;
        }

        function formatDate(d) {
            return d.toLocaleDateString(undefined, { weekday: 'short', month: 'short', day: 'numeric' });
        }

        function updateClock() {
            const now = new Date();
            const timeEl = document.getElementById('clockTime');
            const dateEl = document.getElementById('clockDate');
            if (timeEl) timeEl.textContent = formatTime(now);
            if (dateEl) dateEl.textContent = formatDate(now);
        }

        const PET_PREFS_KEY = 'betaPetPrefsV1';
        const DASHBOARD_KEY = 'betaDashboardStateV1';

        const Achievements = [
            { id: 'streak_3', title: '3-Day Streak', min: 3 },
            { id: 'streak_7', title: '7-Day Streak', min: 7 },
            { id: 'streak_14', title: '14-Day Streak', min: 14 },
            { id: 'streak_30', title: '30-Day Streak', min: 30 },
            { id: 'streak_60', title: '60-Day Streak', min: 60 }
        ];

        function todayKey() {
            const d = new Date();
            const y = d.getFullYear();
            const m = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return `${y}-${m}-${day}`;
        }

        function readDashboardState() {
            try {
                const raw = localStorage.getItem(DASHBOARD_KEY);
                const parsed = raw ? JSON.parse(raw) : null;
                if (!parsed || typeof parsed !== 'object') throw new Error('invalid');

                return {
                    version: 1,
                    coins: Number.isFinite(parsed.coins) ? parsed.coins : 0,
                    lastDailyClaim: typeof parsed.lastDailyClaim === 'string' ? parsed.lastDailyClaim : null,
                    pet: {
                        name: parsed.pet && typeof parsed.pet.name === 'string' ? parsed.pet.name : null,
                        type: parsed.pet && typeof parsed.pet.type === 'string' ? parsed.pet.type : null
                    },
                    unlocked: parsed.unlocked && typeof parsed.unlocked === 'object' ? parsed.unlocked : {}
                };
            } catch {
                const legacy = readPetPrefs();
                return {
                    version: 1,
                    coins: 0,
                    lastDailyClaim: null,
                    pet: { name: legacy.name, type: legacy.type },
                    unlocked: {}
                };
            }
        }

        function writeDashboardState(next) {
            localStorage.setItem(DASHBOARD_KEY, JSON.stringify(next));
        }

        const DashboardStore = (() => {
            let state = readDashboardState();
            const listeners = new Set();

            const notify = () => {
                for (const fn of listeners) fn(state);
            };

            const setState = (patch) => {
                state = { ...state, ...patch };
                writeDashboardState(state);
                notify();
            };

            const getState = () => state;

            const subscribe = (fn) => {
                listeners.add(fn);
                return () => listeners.delete(fn);
            };

            const dispatch = (action) => {
                if (!action || typeof action.type !== 'string') return;

                if (action.type === 'SET_PET') {
                    const next = {
                        ...state,
                        pet: { name: action.name, type: action.petType }
                    };
                    state = next;
                    writeDashboardState(state);
                    writePetPrefs({ name: action.name, type: action.petType });
                    notify();
                    return;
                }

                if (action.type === 'CLAIM_DAILY') {
                    const next = {
                        ...state,
                        coins: (Number(state.coins) || 0) + (Number(action.amount) || 0),
                        lastDailyClaim: todayKey()
                    };
                    state = next;
                    writeDashboardState(state);
                    notify();
                    return;
                }

                if (action.type === 'UNLOCK') {
                    const unlocked = { ...(state.unlocked || {}) };
                    unlocked[action.id] = true;
                    const next = { ...state, unlocked };
                    state = next;
                    writeDashboardState(state);
                    notify();
                    return;
                }

                if (action.type === 'RESET') {
                    localStorage.removeItem(DASHBOARD_KEY);
                    state = readDashboardState();
                    notify();
                    return;
                }
            };

            return { getState, setState, subscribe, dispatch };
        })();

        function readPetPrefs() {
            try {
                const raw = localStorage.getItem(PET_PREFS_KEY);
                const parsed = raw ? JSON.parse(raw) : null;
                return {
                    name: parsed && typeof parsed.name === 'string' ? parsed.name : 'Nova',
                    type: parsed && typeof parsed.type === 'string' ? parsed.type : 'bird'
                };
            } catch {
                return { name: 'Nova', type: 'bird' };
            }
        }

        function writePetPrefs(next) {
            localStorage.setItem(PET_PREFS_KEY, JSON.stringify(next));
        }

        function getPetStages(type) {
            const stagesByType = {
                bird: [
                    { level: 1, min: 0, emoji: 'ü•ö', scale: 1.0 },
                    { level: 2, min: 3, emoji: 'üê£', scale: 1.05 },
                    { level: 3, min: 7, emoji: 'üê•', scale: 1.10 },
                    { level: 4, min: 14, emoji: 'üê§', scale: 1.16 },
                    { level: 5, min: 30, emoji: 'üêî', scale: 1.22 },
                    { level: 6, min: 60, emoji: 'ü¶Ö', scale: 1.30 }
                ],
                cat: [
                    { level: 1, min: 0, emoji: 'üêæ', scale: 1.0 },
                    { level: 2, min: 3, emoji: 'üê±', scale: 1.05 },
                    { level: 3, min: 7, emoji: 'üò∫', scale: 1.10 },
                    { level: 4, min: 14, emoji: 'üò∏', scale: 1.16 },
                    { level: 5, min: 30, emoji: 'ü¶Å', scale: 1.22 },
                    { level: 6, min: 60, emoji: 'üêØ', scale: 1.30 }
                ],
                dragon: [
                    { level: 1, min: 0, emoji: 'ü•ö', scale: 1.0 },
                    { level: 2, min: 3, emoji: 'üêâ', scale: 1.06 },
                    { level: 3, min: 7, emoji: 'üê≤', scale: 1.12 },
                    { level: 4, min: 14, emoji: 'üî•', scale: 1.18 },
                    { level: 5, min: 30, emoji: 'ü™Ω', scale: 1.24 },
                    { level: 6, min: 60, emoji: 'üêâ', scale: 1.32 }
                ],
                slime: [
                    { level: 1, min: 0, emoji: 'ü´ß', scale: 1.0 },
                    { level: 2, min: 3, emoji: 'üü¢', scale: 1.06 },
                    { level: 3, min: 7, emoji: 'üü©', scale: 1.12 },
                    { level: 4, min: 14, emoji: 'üß™', scale: 1.18 },
                    { level: 5, min: 30, emoji: 'üíö', scale: 1.24 },
                    { level: 6, min: 60, emoji: 'üëæ', scale: 1.32 }
                ]
            };

            return stagesByType[type] || stagesByType.bird;
        }

        function updateStatsWidget(currentStreak) {
            const currentEl = document.getElementById('statsCurrent');
            const bestEl = document.getElementById('statsBest');
            const freezesEl = document.getElementById('statsFreezes');
            const petNameEl = document.getElementById('statsPetName');
            const coinsEl = document.getElementById('coinsAmount');
            const achUnlockedEl = document.getElementById('achievementsUnlocked');
            const achTotalEl = document.getElementById('achievementsTotal');

            if (currentEl) currentEl.textContent = String(Number(currentStreak) || 0);
            if (bestEl) bestEl.textContent = String(Number(localStorage.getItem('bestStreak') || 0) || 0);
            if (freezesEl) freezesEl.textContent = String(Number(localStorage.getItem('streakFreezes') || 0) || 0);
            const prefs = readPetPrefs();
            if (petNameEl) petNameEl.textContent = prefs.name || '‚Äî';

            const dash = DashboardStore.getState();
            if (coinsEl) coinsEl.textContent = String(Number(dash.coins) || 0);

            const unlockedCount = Object.values(dash.unlocked || {}).filter(Boolean).length;
            if (achUnlockedEl) achUnlockedEl.textContent = String(unlockedCount);
            if (achTotalEl) achTotalEl.textContent = String(Achievements.length);
        }

        function updateAchievementsUI(streak) {
            const list = document.getElementById('achievementsList');
            const nextEl = document.getElementById('achievementsNext');

            const dash = DashboardStore.getState();
            if (list) {
                list.innerHTML = '';
                for (const a of Achievements) {
                    const unlocked = !!(dash.unlocked && dash.unlocked[a.id]);
                    const badge = document.createElement('div');
                    badge.className = `widget-badge ${unlocked ? 'good' : 'warn'}`;
                    badge.textContent = unlocked ? `${a.title} ‚úì` : `${a.title} (${a.min})`;
                    list.appendChild(badge);
                }
            }

            const next = Achievements.find(a => !((dash.unlocked && dash.unlocked[a.id]) || false));
            if (nextEl) {
                nextEl.textContent = next ? `Next: ${next.title} at ${next.min}` : 'All unlocked';
            }

            for (const a of Achievements) {
                if (streak >= a.min && !(dash.unlocked && dash.unlocked[a.id])) {
                    DashboardStore.dispatch({ type: 'UNLOCK', id: a.id });
                    if (typeof window.showToast === 'function') {
                        window.showToast(`Achievement unlocked: ${a.title}`);
                    }
                }
            }
        }

        function computeDailyReward(streak) {
            const base = 10;
            const bonus = clamp(Math.floor((Number(streak) || 0) / 3), 0, 25);
            return { amount: base + bonus, bonus };
        }

        function updateDailyUI(streak) {
            const status = document.getElementById('dailyStatus');
            const amountEl = document.getElementById('dailyRewardAmount');
            const bonusEl = document.getElementById('dailyBonus');
            const btn = document.getElementById('claimDailyBtn');

            const dash = DashboardStore.getState();
            const today = todayKey();
            const claimed = dash.lastDailyClaim === today;
            const reward = computeDailyReward(streak);

            if (amountEl) amountEl.textContent = String(reward.amount);
            if (bonusEl) bonusEl.textContent = String(reward.bonus);

            if (status) status.textContent = claimed ? 'Already claimed today' : 'Ready to claim';
            if (btn) {
                btn.disabled = claimed;
                btn.style.opacity = claimed ? '0.6' : '1';
                btn.style.pointerEvents = claimed ? 'none' : 'auto';
            }
        }

        window.updatePetWidget = function (streakValue) {
            const streak = Number(streakValue) || 0;
            const avatar = document.getElementById('petAvatar');
            const levelEl = document.getElementById('petLevel');
            const streakEl = document.getElementById('petStreak');

            const prefs = readPetPrefs();
            const petNameInput = document.getElementById('petNameInput');
            const petTypeSelect = document.getElementById('petTypeSelect');
            const subtitle = document.getElementById('petSubtitle');
            const progressText = document.getElementById('petProgressText');
            const nextText = document.getElementById('petNextText');
            const progressBar = document.getElementById('petProgressBar');

            if (petNameInput && petNameInput.value !== prefs.name) {
                petNameInput.value = prefs.name;
            }
            if (petTypeSelect && petTypeSelect.value !== prefs.type) {
                petTypeSelect.value = prefs.type;
            }

            if (subtitle) {
                subtitle.textContent = `${prefs.name} grows with your streak`;
            }

            if (streakEl) streakEl.textContent = String(streak);

            const stages = getPetStages(prefs.type);

            let stage = stages[0];
            for (const s of stages) {
                if (streak >= s.min) stage = s;
            }

            if (levelEl) levelEl.textContent = String(stage.level);
            if (avatar) {
                avatar.textContent = stage.emoji;
                avatar.style.transform = `scale(${stage.scale})`;
            }

            const currentIndex = Math.max(0, stages.findIndex(s => s.level === stage.level));
            const nextStage = stages[currentIndex + 1] || null;
            const curMin = stage.min;
            const nextMin = nextStage ? nextStage.min : (stage.min + 10);
            const span = Math.max(1, nextMin - curMin);
            const within = clamp(streak - curMin, 0, span);
            const pct = Math.round((within / span) * 100);

            if (progressText) {
                progressText.textContent = `${within} / ${span}`;
            }
            if (nextText) {
                nextText.textContent = nextStage ? `Next: ${nextMin}` : 'MAX';
            }
            if (progressBar) {
                progressBar.style.width = `${nextStage ? pct : 100}%`;
            }

            updateStatsWidget(streak);
            updateDailyUI(streak);
            updateAchievementsUI(streak);
        };

        const WIDGETS_LAYOUT_KEY = 'betaWidgetsLayoutV2';

        function readWidgetsLayout() {
            try {
                const raw = localStorage.getItem(WIDGETS_LAYOUT_KEY);
                const parsed = raw ? JSON.parse(raw) : null;
                const order = parsed && Array.isArray(parsed.order) ? parsed.order.filter(Boolean) : [];
                const hidden = parsed && parsed.hidden && typeof parsed.hidden === 'object' ? parsed.hidden : {};
                return { order, hidden };
            } catch {
                return { order: [], hidden: {} };
            }
        }

        function writeWidgetsLayout(next) {
            localStorage.setItem(WIDGETS_LAYOUT_KEY, JSON.stringify(next));
        }

        function getWidgetsGrid() {
            return document.getElementById('widgetsGrid');
        }

        function getWidgetEls() {
            const grid = getWidgetsGrid();
            if (!grid) return [];
            return Array.from(grid.querySelectorAll('[data-widget-key]'));
        }

        function getWidgetElByKey(key) {
            return getWidgetEls().find(el => el.getAttribute('data-widget-key') === key) || null;
        }

        function computeDefaultOrder() {
            return getWidgetEls().map(el => el.getAttribute('data-widget-key')).filter(Boolean);
        }

        function applyWidgetsLayout() {
            const grid = getWidgetsGrid();
            if (!grid) return;
            const layout = readWidgetsLayout();
            const allKeys = computeDefaultOrder();

            const order = layout.order.length ? layout.order.slice() : allKeys.slice();
            for (const k of allKeys) {
                if (!order.includes(k)) order.push(k);
            }

            for (const key of order) {
                const el = getWidgetElByKey(key);
                if (!el) continue;
                grid.appendChild(el);
            }

            for (const el of getWidgetEls()) {
                const key = el.getAttribute('data-widget-key');
                const isHidden = !!layout.hidden[key];
                el.style.display = isHidden ? 'none' : '';
            }

            writeWidgetsLayout({ order, hidden: layout.hidden });
        }

        function setWidgetHidden(key, hidden) {
            const layout = readWidgetsLayout();
            layout.hidden[key] = !!hidden;
            writeWidgetsLayout(layout);
            applyWidgetsLayout();
        }

        function saveCurrentWidgetOrder() {
            const grid = getWidgetsGrid();
            if (!grid) return;
            const layout = readWidgetsLayout();
            const order = Array.from(grid.children)
                .map(el => el.getAttribute && el.getAttribute('data-widget-key'))
                .filter(Boolean);
            writeWidgetsLayout({ order, hidden: layout.hidden });
        }

        function openWidgetsModal() {
            const modal = document.getElementById('widgetsModal');
            const list = document.getElementById('widgetsModalList');
            if (!modal || !list) return;

            const defs = [
                { key: 'pet', icon: 'üêæ', name: 'Streak Pet', desc: 'Your pet grows with your streak' },
                { key: 'clock', icon: 'üïí', name: 'Clock', desc: 'Time + date' },
                { key: 'stats', icon: 'üìà', name: 'Streak Stats', desc: 'Coins, streak, and freezes' },
                { key: 'daily', icon: 'üéÅ', name: 'Daily Reward', desc: 'Claim coins once per day' },
                { key: 'achievements', icon: 'üèÜ', name: 'Achievements', desc: 'Unlock streak milestones' },
                { key: 'actions', icon: '‚ö°', name: 'Quick Actions', desc: 'Useful buttons' },
                { key: 'streaks', icon: 'üî•', name: 'Streaks', desc: 'Open streak calendar page' }
            ];

            const layout = readWidgetsLayout();
            list.innerHTML = '';

            for (const def of defs) {
                const row = document.createElement('div');
                row.className = 'widget-picker-item';

                const left = document.createElement('div');
                left.className = 'widget-picker-left';

                const icon = document.createElement('div');
                icon.className = 'widget-picker-icon';
                icon.textContent = def.icon;

                const textWrap = document.createElement('div');
                const name = document.createElement('div');
                name.className = 'widget-picker-name';
                name.textContent = def.name;
                const desc = document.createElement('div');
                desc.className = 'widget-picker-desc';
                desc.textContent = def.desc;
                textWrap.appendChild(name);
                textWrap.appendChild(desc);

                left.appendChild(icon);
                left.appendChild(textWrap);

                const toggle = document.createElement('input');
                toggle.type = 'checkbox';
                toggle.className = 'widget-picker-toggle';
                toggle.checked = !layout.hidden[def.key];
                toggle.addEventListener('change', function () {
                    setWidgetHidden(def.key, !toggle.checked);
                    const next = readWidgetsLayout();
                    if (toggle.checked && !next.order.includes(def.key)) {
                        next.order.push(def.key);
                        writeWidgetsLayout(next);
                        applyWidgetsLayout();
                    }
                });

                row.appendChild(left);
                row.appendChild(toggle);
                list.appendChild(row);
            }

            modal.classList.add('active');
            modal.setAttribute('aria-hidden', 'false');
        }

        function closeWidgetsModal() {
            const modal = document.getElementById('widgetsModal');
            if (!modal) return;
            modal.classList.remove('active');
            modal.setAttribute('aria-hidden', 'true');
        }

        function initWidgetRemovals() {
            document.querySelectorAll('[data-remove-widget]').forEach(btn => {
                btn.addEventListener('click', function (e) {
                    e.preventDefault();
                    const key = btn.getAttribute('data-remove-widget');
                    if (!key) return;
                    setWidgetHidden(key, true);
                });
            });
        }

        function initWidgetEditMode() {
            const editBtn = document.getElementById('widgetsEditBtn');
            if (!editBtn) return { isEdit: () => false };
            let edit = false;

            const setEdit = (next) => {
                edit = !!next;
                document.body.classList.toggle('widgets-edit', edit);
                editBtn.textContent = edit ? 'Done' : 'Edit';
            };

            editBtn.addEventListener('click', function () {
                setEdit(!edit);
            });

            setEdit(false);
            return { isEdit: () => edit, setEdit };
        }

        function initWidgetDragging(editState) {
            const grid = getWidgetsGrid();
            if (!grid) return;

            let draggingEl = null;
            let placeholder = null;
            let offsetX = 0;
            let offsetY = 0;
            let startPointerId = null;
            let longPressTimer = null;
            let longPressPointerId = null;

            const isHandle = (target) => {
                return !!(target && target.closest && target.closest('.widget-header'));
            };

            const visibleCards = () => getWidgetEls().filter(el => el.style.display !== 'none' && el !== draggingEl);

            const insertPlaceholderNear = (x, y) => {
                const items = visibleCards();
                if (!placeholder) return;
                if (!items.length) {
                    grid.appendChild(placeholder);
                    return;
                }

                let best = null;
                let bestDist = Infinity;
                for (const it of items) {
                    const r = it.getBoundingClientRect();
                    const cx = r.left + r.width / 2;
                    const cy = r.top + r.height / 2;
                    const dist = (cx - x) * (cx - x) + (cy - y) * (cy - y);
                    if (dist < bestDist) {
                        bestDist = dist;
                        best = { el: it, rect: r };
                    }
                }

                if (!best) {
                    grid.appendChild(placeholder);
                    return;
                }

                const before = y < (best.rect.top + best.rect.height / 2);
                grid.insertBefore(placeholder, before ? best.el : best.el.nextSibling);
            };

            const beginDrag = (el, ev) => {
                if (!editState.isEdit()) return;
                const header = ev.target && ev.target.closest ? ev.target.closest('.widget-header') : null;
                if (!header) return;
                const key = el.getAttribute('data-widget-key');
                if (!key) return;

                draggingEl = el;
                startPointerId = ev.pointerId;
                draggingEl.setPointerCapture(startPointerId);

                const r = draggingEl.getBoundingClientRect();
                offsetX = ev.clientX - r.left;
                offsetY = ev.clientY - r.top;

                placeholder = document.createElement('div');
                placeholder.className = 'widget-placeholder';
                placeholder.style.width = `${r.width}px`;
                placeholder.style.height = `${r.height}px`;

                draggingEl.classList.add('widget-dragging');
                draggingEl.style.width = `${r.width}px`;
                draggingEl.style.height = `${r.height}px`;
                draggingEl.style.position = 'fixed';
                draggingEl.style.left = `${r.left}px`;
                draggingEl.style.top = `${r.top}px`;
                draggingEl.style.zIndex = '10006';

                grid.insertBefore(placeholder, draggingEl.nextSibling);

                ev.preventDefault();
            };

            const moveDrag = (ev) => {
                if (!draggingEl || startPointerId !== ev.pointerId) return;
                const x = ev.clientX;
                const y = ev.clientY;

                draggingEl.style.left = `${x - offsetX}px`;
                draggingEl.style.top = `${y - offsetY}px`;
                insertPlaceholderNear(x, y);
            };

            const endDrag = (ev) => {
                if (!draggingEl || startPointerId !== ev.pointerId) return;

                draggingEl.classList.remove('widget-dragging');
                draggingEl.style.position = '';
                draggingEl.style.left = '';
                draggingEl.style.top = '';
                draggingEl.style.zIndex = '';
                draggingEl.style.width = '';
                draggingEl.style.height = '';

                if (placeholder && placeholder.parentNode) {
                    grid.insertBefore(draggingEl, placeholder);
                    placeholder.remove();
                }

                placeholder = null;
                draggingEl = null;
                startPointerId = null;
                saveCurrentWidgetOrder();
            };

            grid.addEventListener('pointerdown', function (ev) {
                if (!isHandle(ev.target)) return;
                const card = ev.target && ev.target.closest ? ev.target.closest('[data-widget-key]') : null;
                if (!card) return;

                if (!editState.isEdit()) {
                    if (longPressTimer) clearTimeout(longPressTimer);
                    longPressPointerId = ev.pointerId;
                    longPressTimer = setTimeout(function () {
                        if (longPressPointerId !== ev.pointerId) return;
                        if (typeof editState.setEdit === 'function') {
                            editState.setEdit(true);
                        }
                        longPressTimer = null;
                        longPressPointerId = null;
                    }, 450);
                    return;
                }

                beginDrag(card, ev);
            });

            grid.addEventListener('pointermove', function (ev) {
                if (!draggingEl) return;
                moveDrag(ev);
            });

            grid.addEventListener('pointerup', function (ev) {
                if (longPressTimer && longPressPointerId === ev.pointerId) {
                    clearTimeout(longPressTimer);
                    longPressTimer = null;
                    longPressPointerId = null;
                }
                if (!draggingEl) return;
                endDrag(ev);
            });

            grid.addEventListener('pointercancel', function (ev) {
                if (longPressTimer && longPressPointerId === ev.pointerId) {
                    clearTimeout(longPressTimer);
                    longPressTimer = null;
                    longPressPointerId = null;
                }
                if (!draggingEl) return;
                endDrag(ev);
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            updateClock();
            setInterval(updateClock, 1000);

            const nameInput = document.getElementById('petNameInput');
            const typeSelect = document.getElementById('petTypeSelect');
            const applyPrefs = () => {
                const dash = DashboardStore.getState();
                const nextName = nameInput ? (nameInput.value || 'Nova').trim().slice(0, 18) : (dash.pet && dash.pet.name) || 'Nova';
                const nextType = typeSelect ? typeSelect.value : (dash.pet && dash.pet.type) || 'bird';
                DashboardStore.dispatch({ type: 'SET_PET', name: nextName, petType: nextType });
                const streakNumber = document.getElementById('streakNumber');
                window.updatePetWidget(streakNumber ? (Number(streakNumber.textContent) || 0) : 0);
            };

            if (nameInput) {
                nameInput.addEventListener('input', function () {
                    applyPrefs();
                });
            }

            if (typeSelect) {
                typeSelect.addEventListener('change', function () {
                    applyPrefs();
                });
            }

            const streakNumber = document.getElementById('streakNumber');
            if (streakNumber) {
                window.updatePetWidget(Number(streakNumber.textContent) || 0);
            }

            const openStreaksBtn = document.getElementById('openStreaksBtn');
            if (openStreaksBtn) {
                openStreaksBtn.addEventListener('click', function () {
                    window.location.href = 'streaks.html';
                });
            }

            const resetPetBtn = document.getElementById('resetPetBtn');
            if (resetPetBtn) {
                resetPetBtn.addEventListener('click', function () {
                    DashboardStore.dispatch({ type: 'SET_PET', name: 'Nova', petType: 'bird' });
                    const streakNumber = document.getElementById('streakNumber');
                    window.updatePetWidget(streakNumber ? (Number(streakNumber.textContent) || 0) : 0);
                    if (typeof window.showToast === 'function') {
                        window.showToast('Pet reset');
                    }
                });
            }

            const resetDashboardBtn = document.getElementById('resetDashboardBtn');
            if (resetDashboardBtn) {
                resetDashboardBtn.addEventListener('click', function () {
                    DashboardStore.dispatch({ type: 'RESET' });
                    const streakNumber = document.getElementById('streakNumber');
                    window.updatePetWidget(streakNumber ? (Number(streakNumber.textContent) || 0) : 0);
                    if (typeof window.showToast === 'function') {
                        window.showToast('Dashboard reset');
                    }
                });
            }

            const claimDailyBtn = document.getElementById('claimDailyBtn');
            if (claimDailyBtn) {
                claimDailyBtn.addEventListener('click', function () {
                    const streak = streakNumber ? (Number(streakNumber.textContent) || 0) : 0;
                    const dash = DashboardStore.getState();
                    const today = todayKey();
                    if (dash.lastDailyClaim === today) return;
                    const reward = computeDailyReward(streak);
                    DashboardStore.dispatch({ type: 'CLAIM_DAILY', amount: reward.amount });
                    window.updatePetWidget(streak);
                    if (typeof window.showToast === 'function') {
                        window.showToast(`Daily reward claimed: +${reward.amount} coins`);
                    }
                });
            }

            const openStreaksCardBtn = document.getElementById('openStreaksCardBtn');
            if (openStreaksCardBtn) {
                openStreaksCardBtn.addEventListener('click', function () {
                    window.location.href = 'streaks.html';
                });
            }

            applyWidgetsLayout();
            initWidgetRemovals();
            const editState = initWidgetEditMode();
            initWidgetDragging(editState);

            const addBtn = document.getElementById('widgetsAddBtn');
            if (addBtn) {
                addBtn.addEventListener('click', function () {
                    openWidgetsModal();
                });
            }

            const modalClose = document.getElementById('widgetsModalClose');
            if (modalClose) {
                modalClose.addEventListener('click', function () {
                    closeWidgetsModal();
                });
            }

            const modal = document.getElementById('widgetsModal');
            if (modal) {
                modal.addEventListener('click', function (e) {
                    if (e.target === modal) closeWidgetsModal();
                });
            }

            DashboardStore.subscribe(function () {
                const streak = streakNumber ? (Number(streakNumber.textContent) || 0) : 0;
                updateStatsWidget(streak);
                updateDailyUI(streak);
                updateAchievementsUI(streak);
            });
        });
    </script>

    <script>
        // Main App Configuration
        const AppConfig = {
            selectors: {
                fullscreenBtn: '#fullscreenBtn',
                fullscreenIcon: '#fullscreenIcon',
                searchInput: '.search-input',
                gameCards: '.game-card',
                settingsBtn: '#settingsBtn',
                settingsMenu: '#settingsMenu',
                closeSettings: '#closeSettings'
            },
            classes: {
                active: 'active',
                darkMode: 'dark-mode',
                lightMode: 'light-mode',
                christmasMode: 'christmas-mode'
            },
            settings: {
                darkMode: false,
                injection: false,
                christmasMode: false
            }
        };

        function getStarSettings() {
            const raw = localStorage.getItem('starSettings');
            let parsed = null;
            try {
                parsed = raw ? JSON.parse(raw) : null;
            } catch {
                parsed = null;
            }

            return {
                enabled: parsed && typeof parsed.enabled === 'boolean' ? parsed.enabled : true,
                count: parsed && Number.isFinite(parsed.count) ? parsed.count : 200,
                speed: parsed && typeof parsed.speed === 'string' ? parsed.speed : 'slow',
                color: parsed && typeof parsed.color === 'string' ? parsed.color : 'white'
            };
        }

        function saveStarSettings(next) {
            localStorage.setItem('starSettings', JSON.stringify(next));
        }

        function renderStars(settings) {
            const container = document.getElementById('starContainer');
            if (!container) return;

            if (!settings.enabled) {
                container.innerHTML = '';
                return;
            }

            const count = Math.max(50, Math.min(500, Number(settings.count) || 200));
            const speed = settings.speed || 'slow';
            const color = settings.color || 'white';

            const durations = {
                slow: { min: 4, max: 8 },
                medium: { min: 2, max: 6 },
                fast: { min: 1, max: 3 }
            };
            const range = durations[speed] || durations.medium;

            const palette = {
                multicolor: ['color1', 'color2', 'color3', 'color4', 'color5'],
                white: ['color1'],
                blue: ['color2'],
                gold: ['color3'],
                pink: ['color4'],
                mint: ['color5']
            };
            const colorClasses = palette[color] || palette.multicolor;

            container.innerHTML = '';
            for (let i = 0; i < count; i++) {
                const star = document.createElement('div');
                const size = Math.random() * 2 + 1;
                const duration = Math.random() * (range.max - range.min) + range.min;
                const delay = Math.random() * 5;
                const opacity = Math.random() * 0.7 + 0.3;

                star.className = `star ${colorClasses[Math.floor(Math.random() * colorClasses.length)]}`;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.animationDuration = `${duration}s`;
                star.style.animationDelay = `${delay}s`;
                star.style.opacity = `${opacity}`;

                container.appendChild(star);
            }
        }

        function initStarControls() {
            const starsToggle = document.getElementById('starsToggle');
            const starsCheckbox = document.getElementById('starsCheckbox');
            const starsCount = document.getElementById('starsCount');
            const starsCountLabel = document.getElementById('starsCountLabel');
            const starsSpeed = document.getElementById('starsSpeed');
            const starsColor = document.getElementById('starsColor');

            if (!starsToggle || !starsCheckbox || !starsCount || !starsCountLabel || !starsSpeed || !starsColor) return;

            const applyUiFromSettings = (s) => {
                starsCheckbox.checked = !!s.enabled;
                starsToggle.classList.toggle('active', !!s.enabled);
                starsCount.value = String(s.count);
                starsCountLabel.textContent = String(s.count);
                starsSpeed.value = s.speed;
                starsColor.value = s.color;
            };

            const current = getStarSettings();
            applyUiFromSettings(current);

            const isSpecialTheme = () =>
                document.body.classList.contains('christmas-theme') ||
                document.body.classList.contains('christmas-mode') ||
                document.body.classList.contains('newyears-theme');
            const starContainer = document.getElementById('starContainer');
            if (starContainer) starContainer.style.display = (!isSpecialTheme() && current.enabled) ? '' : 'none';
            if (!isSpecialTheme()) {
                renderStars(current);
            }

            const commit = () => {
                const next = {
                    enabled: !!starsCheckbox.checked,
                    count: Number(starsCount.value),
                    speed: starsSpeed.value,
                    color: starsColor.value
                };

                saveStarSettings(next);

                if (starContainer) {
                    starContainer.style.display = (!isSpecialTheme() && next.enabled) ? '' : 'none';
                }
                if (!isSpecialTheme()) {
                    renderStars(next);
                } else {
                    renderStars({ enabled: false }); // Force clear if in special theme
                }
            };

            starsToggle.addEventListener('click', () => {
                starsCheckbox.checked = !starsCheckbox.checked;
                starsToggle.classList.toggle('active', starsCheckbox.checked);
                commit();
            });

            starsCount.addEventListener('input', () => {
                starsCountLabel.textContent = starsCount.value;
                commit();
            });

            starsSpeed.addEventListener('change', commit);
            starsColor.addEventListener('change', commit);

            window.addEventListener('resize', () => {
                const s = getStarSettings();
                if (!isSpecialTheme()) {
                    renderStars(s);
                }
            });
        }

        function clearSnow() {
            if (window.snowInterval) {
                clearInterval(window.snowInterval);
                window.snowInterval = null;
            }
            const snowflakes = document.querySelectorAll('.snowflake');
            snowflakes.forEach(flake => flake.remove());
        }

        function initSnow() {
            clearSnow();

            const spawn = () => {
                const flake = document.createElement('div');
                flake.className = 'snowflake';
                flake.textContent = '‚ùÑ';

                const size = Math.random() * 10 + 10;
                const left = Math.random() * 100;
                const fallDuration = Math.random() * 5 + 7;
                const swayDuration = Math.random() * 2 + 3;
                const delay = Math.random() * 2;
                const opacity = Math.random() * 0.5 + 0.35;

                flake.style.left = `${left}vw`;
                flake.style.fontSize = `${size}px`;
                flake.style.opacity = `${opacity}`;
                flake.style.animationDuration = `${fallDuration}s, ${swayDuration}s`;
                flake.style.animationDelay = `${delay}s, ${Math.random() * 1.5}s`;

                document.body.appendChild(flake);

                const ttl = (fallDuration + delay + 1) * 1000;
                window.setTimeout(() => flake.remove(), ttl);
            };

            for (let i = 0; i < 30; i++) {
                window.setTimeout(spawn, Math.random() * 1500);
            }
            window.snowInterval = window.setInterval(spawn, 250);
        }

        // Update stars visibility based on theme
        window.updateStarsForTheme = function (theme) {
            const isSpecialMode = theme === 'christmas' || theme === 'newyears';
            const starContainer = document.getElementById('starContainer');
            const s = getStarSettings();

            if (isSpecialMode) {
                if (starContainer) starContainer.style.display = 'none';
            } else {
                if (starContainer) starContainer.style.display = s.enabled ? '' : 'none';
                renderStars(s);
            }
        };


        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize components
            initFullscreen();
            initSearch();
            initSettings();
            initStarControls();
        });

        // Fullscreen functionality
        function initFullscreen() {
            const fullscreenBtn = document.querySelector(AppConfig.selectors.fullscreenBtn);
            const fullscreenIcon = document.querySelector(AppConfig.selectors.fullscreenIcon);
            let isFullscreen = false;

            if (!fullscreenBtn || !fullscreenIcon) return;

            const isFullscreenSupported = () =>
                document.fullscreenEnabled ||
                document.webkitFullscreenEnabled ||
                document.mozFullScreenEnabled ||
                document.msFullscreenEnabled;

            const enterFullscreen = () => {
                const elem = document.documentElement;
                const requestFullscreen =
                    elem.requestFullscreen ||
                    elem.webkitRequestFullscreen ||
                    elem.mozRequestFullScreen ||
                    elem.msRequestFullscreen;

                if (requestFullscreen) {
                    requestFullscreen.call(elem);
                }
            };

            const exitFullscreen = () => {
                const exit =
                    document.exitFullscreen ||
                    document.webkitExitFullscreen ||
                    document.mozCancelFullScreen ||
                    document.msExitFullscreen;

                if (exit) {
                    exit.call(document);
                }
            };

            const updateFullscreenState = () => {
                const isFullscreenNow = !!(
                    document.fullscreenElement ||
                    document.webkitFullscreenElement ||
                    document.mozFullScreenElement ||
                    document.msFullscreenElement
                );

                isFullscreen = isFullscreenNow;
                if (fullscreenIcon) {
                    fullscreenIcon.textContent = isFullscreenNow ? '‚õ∂' : '‚õ∂';
                }
            };

            // Event listeners
            fullscreenBtn.addEventListener('click', () => {
                isFullscreen ? exitFullscreen() : enterFullscreen();
            });

            // Fullscreen change events
            ['fullscreenchange', 'webkitfullscreenchange', 'mozfullscreenchange', 'MSFullscreenChange']
                .forEach(event => document.addEventListener(event, updateFullscreenState));

            // Hide button if not supported
            if (!isFullscreenSupported()) {
                fullscreenBtn.style.display = 'none';
            }
        }

        // Live search filter for game cards
        function initSearch() {
            const searchInput = document.querySelector(AppConfig.selectors.searchInput);
            const gameCards = document.querySelectorAll(AppConfig.selectors.gameCards);

            searchInput.addEventListener('input', () => {
                const query = searchInput.value.trim().toLowerCase();
                gameCards.forEach(card => {
                    const text = card.textContent.trim().toLowerCase();
                    if (query === "" || text.includes(query)) {
                        card.style.display = '';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        }

        // Settings functionality
        function initSettings() {
            // Prevent duplicate execution
            if (window.initSettingsCalled) return;
            window.initSettingsCalled = true;

            const settingsBtn = document.querySelector(AppConfig.selectors.settingsBtn);
            const settingsMenu = document.querySelector(AppConfig.selectors.settingsMenu);
            const closeSettings = document.querySelector(AppConfig.selectors.closeSettings);

            // Injection button
            const openInjectionBtn = document.getElementById('openInjectionBtn');
            const openBackgroundSettingsBtn = document.getElementById('openBackgroundSettingsBtn');

            // Toggle settings menu
            function toggleSettings(event) {
                event.stopPropagation();
                settingsMenu.classList.toggle('active');
            }

            // Close settings menu
            function closeSettingsMenu() {
                settingsMenu.classList.remove('active');
            }

            // Event listeners
            settingsBtn.addEventListener('click', toggleSettings);
            closeSettings.addEventListener('click', closeSettingsMenu);

            if (openBackgroundSettingsBtn) {
                openBackgroundSettingsBtn.addEventListener('click', (event) => {
                    event.stopPropagation();
                    window.location.href = 'background-settings.html';
                });
            }

            // Close menu when clicking outside
            document.addEventListener('click', (event) => {
                if (settingsMenu && settingsBtn &&
                    !settingsMenu.contains(event.target) &&
                    !settingsBtn.contains(event.target)) {
                    closeSettingsMenu();
                }
            });

            // About:Blank injection function
            function openAboutBlank() {
                const newTab = window.open('about:blank', '_blank');

                if (newTab) {
                    newTab.document.write('<html><head><title>Brayden-is-tall-games</title></head><body style="margin:0; padding:0; overflow:hidden;">');
                    newTab.document.write('<iframe src="https://braydenistallgames.online" style="border:none; width:100vw; height:100vh;"></iframe>');
                    newTab.document.write('</body></html>');
                    newTab.document.close();
                } else {
                    alert('Popup blocked! Please allow popups for this site.');
                }
            }

            // Add event listener for the injection button
            openInjectionBtn.addEventListener('click', openAboutBlank);
        }

        // Prevent zoom on double tap for mobile (only prevent if it's a true double tap, not scroll)
        let lastTouchEnd = 0;
        let touchStartY = 0;

        document.addEventListener('touchstart', function (event) {
            if (event.touches.length === 1) {
                touchStartY = event.touches[0].clientY;
            }
        }, { passive: true });

        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            const timeDiff = now - lastTouchEnd;
            const touchEndY = event.changedTouches[0].clientY;
            const yDiff = Math.abs(touchEndY - touchStartY);

            const willPrevent = timeDiff <= 200 && yDiff <= 2;

            // Only prevent default if it's a very quick double tap with almost no movement (not a scroll)
            if (willPrevent) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // Prevent context menu on long press
        document.addEventListener('contextmenu', function (e) {
            e.preventDefault();
        });

        // Auto-hide fullscreen button after 3 seconds on mobile
        if (window.innerWidth <= 768) {
            setTimeout(() => {
                document.querySelector(AppConfig.selectors.fullscreenBtn).style.opacity = '0.7';
            }, 3000);
        }
    </script>

    <!-- Streak Functionality -->

    <!-- Version and Privacy Links -->
    <div style="position: fixed; bottom: 10px; left: 10px; z-index: 1000;
color: rgba(255, 255, 255, 0.3);
font-size: 0.8rem;
font-family: 'Orbitron', sans-serif;">
        vS3.8
    </div>

    <div style="position: fixed; bottom: 10px; right: 10px; z-index: 1000; display: flex; gap: 15px; flex-wrap: wrap;">
        <a href="privacy-policy.html"
            style="color: rgba(255, 255, 255, 0.3); text-decoration: none; font-size: 0.8rem; font-family: 'Source Code Pro', monospace;">Privacy</a>
        <a href="terms-of-service.html"
            style="color: rgba(255, 255, 255, 0.3); text-decoration: none; font-size: 0.8rem; font-family: 'Source Code Pro', monospace;">Terms</a>
        <a href="contact.html"
            style="color: rgba(255, 255, 255, 0.3); text-decoration: none; font-size: 0.8rem; font-family: 'Source Code Pro', monospace;">Contact</a>
        <a href="about.html"
            style="color: rgba(255, 255, 255, 0.3); text-decoration: none; font-size: 0.8rem; font-family: 'Source Code Pro', monospace;">About</a>
    </div>
    <script src="background-loader.js"></script> <!-- Background theme loader -->

    <!-- Toast notification element -->
    <div class="toast" id="toast"></div>

    <script>
        (function () {
            const s = getStarSettings();
            const theme = localStorage.getItem('selectedTheme') || 'christmas';
            const isSpecial = theme === 'christmas' || theme === 'newyears';
            const container = document.getElementById('starContainer');
            if (container) {
                container.style.display = (!isSpecial && s.enabled) ? '' : 'none';
                if (!isSpecial) renderStars(s);
            }
        })();
    </script>
</body>

</html>